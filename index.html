<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
    <title>Academia Espacial: Física Interactiva</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Inter:wght@400;600&family=Exo+2:wght@300;400;600;800&display=swap" rel="stylesheet">
    
    <style>
        /* D E C O R A C I Ó N: Paleta de colores y variables globales para un tema futurista. */
        :root {
            --primary-color: #00faff;
            --secondary-color: #ff00ff;
            --accent-color: #ffff00;
            --background-dark: #0a0a1f;
            --background-light: #1a1a3f;
            --text-light: #e0fbfc;
            --success-color: #00ff88;
            --error-color: #ff4444;
            --warning-color: #ffaa00;
            --glass-bg: rgba(10, 10, 31, 0.5);
            --glass-border: rgba(0, 250, 255, 0.2);
        }

        /* I N D I C A C I Ó N: Estilos base para el cuerpo del documento. */
        html, body {
            margin: 0; padding: 0; width: 100%; height: 100%; 
            overflow-x: hidden; 
            font-family: 'Exo 2', sans-serif;
            background: var(--background-dark);
            color: var(--text-light);
        }

        .game-wrapper {
            width: 100%; min-height: 100vh; display: flex; flex-direction: column;
            background: linear-gradient(135deg, var(--background-dark) 0%, #1a1a3f 50%, #0a0a1f 100%);
        }

        canvas {
            flex-grow: 1;
            touch-action: none;
            display: block;
            min-height: 200px;
        }
        
        /* D E C O R A C I Ó N: Paneles holográficos rediseñados con efecto de vidrio (glassmorphism). */
        .stats-bar, .controls-container {
            font-family: 'Orbitron', sans-serif;
            color: var(--primary-color);
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px); /* Soporte para Safari */
            border: 1px solid var(--glass-border);
            padding: 1rem;
            display: flex;
            justify-content: space-around;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
            flex-shrink: 0;
            position: relative;
            text-shadow: 0 0 4px var(--primary-color);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37), inset 0 1px 1px rgba(255, 255, 255, 0.1);
            margin: 10px;
            border-radius: 16px;
        }

        .stat, .control-group {
            display: flex; align-items: center; gap: 8px;
            padding: 6px 12px;
            border-radius: 8px;
            background: rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(0, 250, 255, 0.1);
            transition: all 0.3s ease;
            font-size: 0.8rem;
        }
        
        /* D E C O R A C I Ó N: Botones de selección de tema con efecto de cristal iluminado. */
        .topic-switcher {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 8px; margin-bottom: 10px; width: 100%;
        }

        .topic-switcher label {
            padding: 10px 12px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
            font-size: 0.8rem;
            text-align: center;
            position: relative;
            background: linear-gradient(145deg, rgba(0, 0, 0, 0.25), rgba(0, 0, 0, 0.4));
            border: 1px solid rgba(0, 250, 255, 0.2);
            color: rgba(0, 250, 255, 0.7);
            text-shadow: none;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.5);
        }

        .topic-switcher label:hover {
            color: var(--text-light);
            background: rgba(0, 250, 255, 0.1);
            border-color: rgba(0, 250, 255, 0.7);
            transform: translateY(-2px);
            box-shadow: 0 0 15px -5px var(--primary-color);
        }
        
        .topic-switcher input[type="checkbox"] { display: none; }
        
        .topic-switcher input[type="checkbox"]:checked + label {
            background: var(--primary-color);
            color: var(--background-dark);
            border-color: var(--primary-color);
            box-shadow: 0 0 25px var(--primary-color), inset 0 0 10px rgba(255,255,255,0.5);
            text-shadow: none;
            font-weight: bold;
            transform: translateY(-2px) scale(1.05);
        }

        /* D E C O R A C I Ó N: Botones de acción principales con gradiente y borde de neón. */
        .game-button {
            font-family: 'Orbitron', sans-serif;
            background: linear-gradient(145deg, rgba(255,255,255,0.05), rgba(255,255,255,0));
            color: var(--text-light); 
            border: 2px solid transparent;
            background-clip: padding-box;
            border-radius: 12px;
            padding: 10px 18px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-shadow: 0 0 8px rgba(0,0,0,0.7);
            position: relative;
            text-transform: uppercase;
            font-weight: 700;
            letter-spacing: 1.5px;
            font-size: 0.9rem;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }

        .game-button::before {
            content: '';
            position: absolute;
            top: 0; right: 0; bottom: 0; left: 0;
            z-index: -1;
            margin: -2px; 
            border-radius: inherit; 
            background: linear-gradient(120deg, var(--secondary-color), var(--primary-color), var(--accent-color));
            transition: all 0.4s ease;
        }

        .game-button:hover::before {
            filter: brightness(1.3);
            background-size: 200%;
        }
        
        .game-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.5);
            text-shadow: 0 0 5px var(--text-light);
        }

        .game-button:active { transform: translateY(-1px); }
        .game-button:disabled { background: rgba(0,0,0,0.3); color: rgba(255,255,255,0.3); cursor: not-allowed; box-shadow: none; transform: none; }
        .game-button:disabled::before { background: rgba(255,255,255,0.1); }
        
        /* D E C O R A C I Ó N: Clases de botones para diferentes acciones (éxito, advertencia, error). */
        .btn-success::before { background: linear-gradient(120deg, var(--success-color), var(--primary-color)); }
        .btn-warning::before { background: linear-gradient(120deg, var(--warning-color), var(--accent-color)); }
        #resetButton::before { background: linear-gradient(120deg, var(--error-color), var(--secondary-color)); }

        /* D E C O R A C I Ó N: Estilos para las ventanas modales (preguntas, feedback, etc.). */
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(10,10,31,0.6); align-items: center; justify-content: center; backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px); }
        .modal-content { background: var(--glass-bg); border: 1px solid var(--primary-color); padding: 20px; border-radius: 16px; text-align: center; width: 90%; max-width: 500px; color: var(--text-light); box-shadow: 0 0 50px -10px rgba(0, 250, 255, 0.4); max-height: 90vh; overflow-y: auto; position: relative; animation: modalAppear 0.4s cubic-bezier(0.25, 1, 0.5, 1); }
        @keyframes modalAppear { from { opacity: 0; transform: scale(0.8) translateY(-20px); } to { opacity: 1; transform: scale(1) translateY(0); } }
        .modal-content h2 { font-family: 'Orbitron', sans-serif; color: var(--primary-color); margin-bottom: 15px; font-size: 1.5rem; text-shadow: 0 0 10px var(--primary-color); }
        
        /* D E C O R A C I Ó N: Botones de opción dentro de las modales. */
        .option-button { background: rgba(0,0,0, 0.2); border: 1px solid var(--glass-border); color: var(--text-light); width: 100%; padding: 12px; margin: 6px 0; font-size: 0.9rem; cursor: pointer; border-radius: 10px; transition: all 0.3s ease; position: relative; }
        .option-button:hover { background-color: rgba(0, 250, 255, 0.15); border-color: var(--primary-color); transform: scale(1.02); }
        .option-button.selected { background: var(--primary-color); color: var(--background-dark); border-color: var(--primary-color); box-shadow: 0 0 15px var(--primary-color); font-weight: 600; transform: scale(1.02); }
        
        /* I N D I C A C I Ó N: Contenedor para mostrar la solución de las preguntas. */
        #solution-container { margin-top: 20px; padding: 15px; border-top: 1px solid var(--glass-border); text-align: left; font-family: 'Inter', sans-serif; background: rgba(0, 0, 0, 0.3); border-radius: 8px; font-size: 1em; line-height: 1.7; }
        #solution-container h4 { color: var(--accent-color); margin-bottom: 10px; font-family: 'Orbitron', sans-serif; text-shadow: 0 0 5px var(--accent-color); }
        
        /* D E C O R A C I Ó N: Barra de progreso. */
        .progress-bar { width: 100%; height: 6px; background: rgba(0,0,0,0.3); border-radius: 3px; overflow: hidden; margin-top: 5px; box-shadow: inset 0 1px 3px rgba(0,0,0,0.5); }
        .progress-fill { height: 100%; background: linear-gradient(90deg, var(--primary-color), var(--secondary-color)); border-radius: 3px; transition: width 0.5s ease; box-shadow: 0 0 8px var(--primary-color); }
        
        /* D E C O R A C I Ó N: Indicador de vidas con animación de latido. */
        .lives-container { display: flex; gap: 5px; }
        .heart { color: var(--error-color); font-size: 1.2rem; animation: heartbeat 1.5s infinite; filter: drop-shadow(0 0 4px var(--error-color)); }
        .heart.lost { color: rgba(255,255,255,0.15); animation: none; filter: none; }
        @keyframes heartbeat { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.15); } }
        
        /* D E C O R A C I Ó N: Pie de página con efecto de brillo. */
        .galactic-footer { padding: 15px; background: linear-gradient(0deg, #000008 0%, var(--background-dark) 100%); text-align: center; font-family: 'Orbitron', sans-serif; color: var(--primary-color); text-shadow: 0 0 8px var(--primary-color); position: relative; flex-shrink: 0; overflow: hidden; border-top: 1px solid var(--glass-border); box-shadow: 0 -5px 20px -5px rgba(0, 250, 255, 0.2); }
        .footer-author { font-size: 0.9rem; font-weight: bold; letter-spacing: 1px; position: relative; z-index: 1; }
        
        /* I N D I C A C I Ó N: Estilos para mostrar/ocultar texto en botones según el tamaño de pantalla. */
        .btn-text { display: none; } 
        .btn-icon { display: inline; font-size: 1.2rem; }

        /* I N D I C A C I Ó N: Media Query para pantallas más grandes (tablets y escritorios). */
        @media (min-width: 768px) {
            .stats-bar, .controls-container { padding: 1.25rem; gap: 20px; }
            .stat, .control-group { padding: 8px 15px; gap: 10px; font-size: 1rem; }
            .topic-switcher label { font-size: 0.9rem; padding: 10px 15px; }
            .game-button { font-size: 1rem; padding: 12px 25px; }
            .modal-content { max-width: 600px; padding: 30px; }
            .modal-content h2 { font-size: 1.8rem; }
            .option-button { padding: 15px; font-size: 1rem; }
            .footer-author { font-size: 1rem; }
            .btn-text { display: inline; }
            .btn-icon { margin-right: 8px; font-size: 1rem; }
        }
    </style>
</head>

<body>
    <!-- I N D I C A C I Ó N: Contenedor principal que envuelve toda la aplicación del juego. -->
    <div class="game-wrapper" id="gameWrapper">
        
        <!-- I N D I C A C I Ó N: Barra superior para mostrar las estadísticas vitales del juego. -->
        <div class="stats-bar">
            <div class="stat"><span>Nivel:</span><span id="level" class="font-bold">1</span></div>
            <div class="stat"><span>Vidas:</span><div class="lives-container" id="livesContainer"></div></div>
            <div class="stat"><span>Puntos:</span><span id="score" class="font-bold">0</span></div>
            <div class="stat">
                <span>Progreso:</span>
                <span id="progress" class="font-bold">0/10</span>
                <div class="progress-bar w-16 md:w-20"><div id="progressFill" class="progress-fill"></div></div>
            </div>
            <div class="stat"><span>Nota:</span><span id="grade" class="font-bold">0.0</span><span class="text-yellow-400">⭐</span></div>
            <div class="stat hidden md:flex"><span>Tema:</span><span id="currentTopic" class="font-bold">Magnitudes</span></div>
        </div>

        <!-- I N D I C A C I Ó N: El lienzo (canvas) donde se dibujará y animará el juego. -->
        <canvas id="gameCanvas"></canvas>

        <!-- I N D I C A C I Ó N: Panel inferior con todos los controles del juego. -->
        <div class="controls-container">
            <div class="control-group" style="width: 100%;">
                <label class="font-bold text-sm text-center w-full mb-2">SELECCIONAR TEMAS DE FÍSICA</label>
                <div class="topic-switcher">
                    <input type="checkbox" id="topicMagnitudes" name="gameTopics" value="magnitudes" checked><label for="topicMagnitudes">Magnitudes</label>
                    <input type="checkbox" id="topicSI" name="gameTopics" value="si"><label for="topicSI">Sistema SI</label>
                    <input type="checkbox" id="topicCinematica" name="gameTopics" value="cinematica"><label for="topicCinematica">Cinemática</label>
                    <input type="checkbox" id="topicMRU" name="gameTopics" value="mru"><label for="topicMRU">MRU</label>
                    <input type="checkbox" id="topicMRUA" name="gameTopics" value="mrua"><label for="topicMRUA">MRUA</label>
                    <input type="checkbox" id="topicMCU" name="gameTopics" value="mcu"><label for="topicMCU">MCU</label>
                    <input type="checkbox" id="topicGravedad" name="gameTopics" value="gravedad"><label for="topicGravedad">Mov. Vertical</label>
                    <input type="checkbox" id="topicParabolico" name="gameTopics" value="parabolico"><label for="topicParabolico">Mov. Parabólico</label>
                </div>
            </div>
            <div class="flex flex-wrap gap-3 md:gap-4 items-center justify-center w-full">
                <div class="control-group">
                    <label for="levelSelect" class="font-bold">Nivel:</label>
                    <select id="levelSelect" class="bg-gray-800 text-white border border-cyan-400 rounded px-2 py-1 md:px-3 md:py-2">
                        <option value="1">1 (10)</option><option value="2">2 (20)</option><option value="3">3 (30)</option>
                    </select>
                </div>
                <!-- D E C O R A C I Ó N: Botones de acción con iconos y texto para una mejor UX. -->
                <button id="startButton" class="game-button btn-success"><span class="btn-icon">🚀</span><span class="btn-text">Iniciar</span></button>
                <button id="pauseButton" class="game-button btn-warning" disabled><span class="btn-icon">⏸️</span><span class="btn-text">Pausa</span></button>
                <button id="soundButton" class="game-button"><span class="btn-icon">🔊</span><span class="btn-text">Sonido</span></button>
                <button id="helpButton" class="game-button"><span class="btn-icon">❓</span><span class="btn-text">Ayuda</span></button>
                <button id="resetButton" class="game-button"><span class="btn-icon">🔄</span><span class="btn-text">Reiniciar</span></button>
            </div>
        </div>
        
        <!-- I N D I C A C I Ó N: Pie de página con créditos. -->
        <footer class="galactic-footer">
            <div class="footer-author">Autor: Msc Néstor Fabio Montoya Palacios</div>
        </footer>
    </div>
    
    <!-- M A R C A C I Ó N: Estructura HTML para las ventanas modales del juego. -->
    <!-- I N D I C A C I Ó N: Modal para mostrar las preguntas de física. -->
    <div id="questionModal" class="modal"><div class="modal-content"><h2 class="!text-xl md:!text-2xl">🎯 Desafío de Física</h2><div id="questionData" class="mb-4 p-3 bg-gray-800 rounded text-xs md:text-sm"></div><div id="questionText" class="text-base md:text-lg mb-6 leading-relaxed"></div><div id="optionsContainer" class="space-y-3"></div><button id="answerButton" class="game-button btn-success mt-6" disabled>✅ Confirmar</button></div></div>
    <!-- I N D I C A C I Ó N: Modal para dar feedback (correcto/incorrecto) y mostrar la solución. -->
    <div id="feedbackModal" class="modal"><div class="modal-content"><h2 id="feedbackTitle"></h2><p id="feedbackText" class="text-lg mb-4"></p><div id="solution-container" style="display: none;"></div><button id="nextButton" class="game-button btn-success mt-6">▶️ Continuar</button></div></div>
    <!-- I N D I C A C I Ó N: Modal de ayuda con las instrucciones del juego. -->
    <div id="helpModal" class="modal"><div class="modal-content"><h2>📚 Manual del Cadete</h2><div class="text-left space-y-4 text-sm"><h3 class="text-cyan-400 font-bold text-lg mb-2">🎯 Misión</h3><p>Pilota tu nave 🚀 y colisiona con meteoritos ☄️. ¡Responde preguntas de física para dominar el universo!</p><h3 class="text-cyan-400 font-bold text-lg mb-2">🎮 Controles</h3><ul class="list-disc list-inside space-y-1 ml-4"><li><strong>Mouse/Dedo:</strong> Mueve la nave</li><li><strong>Colisiones:</strong> Toca meteoritos para aprender</li><li><strong>Temas:</strong> Elige uno o varios temas</li><li><strong>Sonido:</strong> Activa/desactiva con 🔊</li></ul></div><button id="closeHelp" class="game-button mt-6">🚀 ¡Entendido!</button></div></div>
    <!-- I N D I C A C I Ó N: Modal para notificar al jugador que ha subido de nivel. -->
    <div id="levelUpModal" class="modal"><div class="modal-content"><h2 id="levelUpTitle" class="text-2xl"></h2><p id="levelUpText" class="text-lg mb-6"></p><div id="levelUpStats" class="mb-6 p-4 bg-gray-800 rounded"></div><button id="nextLevelButton" class="game-button btn-success">🚀 ¡Siguiente Nivel!</button></div></div>
    <!-- I N D I C A C I Ó N: Modal que aparece al pausar el juego. -->
    <div id="pauseModal" class="modal"><div class="modal-content"><h2>⏸️ Juego Pausado</h2><p class="text-lg mb-6">El tiempo se ha detenido.</p><div class="space-y-4"><button id="resumeButton" class="game-button btn-success">▶️ Reanudar</button><button id="restartFromPause" class="game-button">🔄 Reiniciar</button></div></div></div>
    <!-- I N D I C A C I Ó N: Modal para mostrar las estadísticas finales al terminar o perder. -->
    <div id="finalStatsModal" class="modal"><div class="modal-content"><h2 id="finalStatsTitle"></h2><div id="finalStatsContent" class="text-left space-y-3 mt-4"></div><button id="restartGameButton" class="game-button btn-success mt-6">🚀 Jugar de Nuevo</button></div></div>

</body>


<script>
        // C O M E N T A R I O: Configuración global de MathJax para renderizar fórmulas LaTeX.
        // I N D I C A C I Ó N: Esto le dice a MathJax cómo identificar las fórmulas matemáticas en el texto.
        // '$...$' para matemáticas en línea y '$$...$$' para matemáticas en bloque.
        window.MathJax = { 
            tex: { 
                inlineMath: [['$', '$'], ['\\(', '\\)']], 
                displayMath: [['$$', '$$'], ['\\[', '\\]']], 
                processEscapes: true, 
                processEnvironments: true 
            }, 
            options: { 
                skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre'] 
            }, 
            startup: { 
                ready: () => { 
                    console.log('✅ MathJax cargado y listo.'); 
                    MathJax.startup.defaultReady(); 
                } 
            } 
        };
        
        // I N D I C A C I Ó N: Detección de tipo de dispositivo para adaptar la experiencia de juego.
        // C O M E N T A R I O: Comprueba el ancho de la ventana para determinar si es móvil, tablet o escritorio.
        function getDeviceType() { 
            const width = window.innerWidth; 
            if (width < 768) return 'mobile'; 
            if (width < 1024) return 'tablet'; 
            return 'desktop'; 
        }
        const deviceType = getDeviceType();
        
        // C O M E N T A R I O: Objeto de configuración adaptable según el dispositivo detectado.
        // I N D I C A C I Ó N: Reduce la cantidad de objetos y su velocidad en dispositivos móviles para mantener el rendimiento.
        const ADAPTIVE_CONFIG = {
            desktop: { MAX_STARS: 250, COSMIC_OBJECTS: { meteorites: { count: 6, speed: 1, size: 25 }, planets: { count: 8, speed: 0, size: 50 }, comets: { count: 3, speed: 1.5, size: 20 } } },
            tablet: { MAX_STARS: 180, COSMIC_OBJECTS: { meteorites: { count: 5, speed: 0.8, size: 22 }, planets: { count: 6, speed: 0, size: 45 }, comets: { count: 2, speed: 1.2, size: 18 } } },
            mobile: { MAX_STARS: 100, COSMIC_OBJECTS: { meteorites: { count: 4, speed: 0.7, size: 20 }, planets: { count: 5, speed: 0, size: 40 }, comets: { count: 1, speed: 1, size: 16 } } }
        };
        
        // C O M E N T A R I O: Configuración principal y constantes del juego.
        // I N D I C A C I Ó N: Combina las configuraciones base con la configuración adaptable al dispositivo.
        const CONFIG = { 
            INITIAL_LIVES: 5, 
            POINTS_PER_CORRECT: 100, 
            LEVEL_BONUS_MULTIPLIER: 50, 
            SPACESHIP: { speed: 2, size: 30, trailLength: 20 }, 
            LEVELS: { 1: { questions: 10, name: "Cadete Espacial" }, 2: { questions: 20, name: "Piloto Avanzado" }, 3: { questions: 30, name: "Comandante Supremo" } }, 
            ...ADAPTIVE_CONFIG[deviceType] 
        };
        
        console.log(`Dispositivo detectado: ${deviceType}. Configuración optimizada aplicada.`);

        // I N D I C A C I Ó N: Clase para gestionar el sistema de audio del juego.
        // C O M E N T A R I O: Utiliza la Web Audio API para generar tonos simples, evitando la necesidad de cargar archivos de audio.
        class AudioSystem { 
            constructor() { 
                this.enabled = true; 
                this.context = null; 
            } 
            // I N D I C A C I Ó N: El audio debe ser inicializado por una acción del usuario (como un clic). Lo asociaremos al botón de inicio.
            async init() { 
                if (this.context) return;
                try { 
                    this.context = new (window.AudioContext || window.webkitAudioContext)(); 
                } catch (error) { 
                    this.enabled = false; 
                    console.warn("AudioContext no es compatible. El audio estará desactivado."); 
                } 
            } 
            createTone(frequency, duration, type = 'sine') { 
                if (!this.enabled || !this.context) return; 
                const oscillator = this.context.createOscillator(); 
                const gainNode = this.context.createGain(); 
                oscillator.connect(gainNode); 
                gainNode.connect(this.context.destination); 
                oscillator.frequency.setValueAtTime(frequency, this.context.currentTime); 
                oscillator.type = type; 
                gainNode.gain.setValueAtTime(0.1, this.context.currentTime); 
                gainNode.gain.exponentialRampToValueAtTime(0.01, this.context.currentTime + duration); 
                oscillator.start(this.context.currentTime); 
                oscillator.stop(this.context.currentTime + duration); 
            } 
            play(type) { 
                if (!this.enabled || !this.context) return; 
                // C O M E N T A R I O: Diferentes sonidos para diferentes eventos del juego.
                switch(type) { 
                    case 'success': this.createTone(800, 0.1, 'square'); break; 
                    case 'error': this.createTone(200, 0.3, 'sawtooth'); break; 
                    case 'collision': this.createTone(300, 0.2, 'triangle'); break; 
                    case 'levelUp': this.createTone(600, 0.2, 'sine'); break; 
                } 
            } 
            toggle() { 
                this.enabled = !this.enabled; 
                return this.enabled; 
            } 
        }
        
        // C O M E N T A R I O: Objeto que almacenará el estado actual y dinámico del juego.
        let gameState = {};
        let audioSystem = null;
        
        // C O M E N T A R I O: Centraliza todos los elementos del DOM para un acceso rápido y eficiente.
        const elements = { 
            canvas: document.getElementById('gameCanvas'), 
            ctx: null, 
            level: document.getElementById('level'), 
            lives: document.getElementById('livesContainer'), 
            score: document.getElementById('score'), 
            progress: document.getElementById('progress'), 
            progressFill: document.getElementById('progressFill'), 
            grade: document.getElementById('grade'), 
            currentTopic: document.getElementById('currentTopic'), 
            topicCheckboxes: document.querySelectorAll('input[name="gameTopics"]'), 
            levelSelect: document.getElementById('levelSelect'), 
            startButton: document.getElementById('startButton'), 
            pauseButton: document.getElementById('pauseButton'), 
            helpButton: document.getElementById('helpButton'), 
            resetButton: document.getElementById('resetButton'), 
            questionModal: document.getElementById('questionModal'), 
            feedbackModal: document.getElementById('feedbackModal'), 
            helpModal: document.getElementById('helpModal'), 
            levelUpModal: document.getElementById('levelUpModal'), 
            pauseModal: document.getElementById('pauseModal'), 
            finalStatsModal: document.getElementById('finalStatsModal'), 
            finalStatsTitle: document.getElementById('finalStatsTitle'), 
            finalStatsContent: document.getElementById('finalStatsContent'), 
            restartGameButton: document.getElementById('restartGameButton'), 
            questionData: document.getElementById('questionData'), 
            questionText: document.getElementById('questionText'), 
            optionsContainer: document.getElementById('optionsContainer'), 
            answerButton: document.getElementById('answerButton'), 
            feedbackTitle: document.getElementById('feedbackTitle'), 
            feedbackText: document.getElementById('feedbackText'), 
            solutionContainer: document.getElementById('solution-container'), 
            nextButton: document.getElementById('nextButton') 
        };

// C O M E N T A R I O: Base de datos de preguntas de física, organizada por temas.
        // I N D I C A C I Ó N: Cada pregunta es un objeto con su tipo (teoría/cálculo), texto, opciones,
        // la respuesta correcta (índice base 0), una explicación detallada y un nivel de dificultad.
        // Se han escapado todas las barras invertidas (`\`) en las cadenas de LaTeX (`\\`).
        // Se han eliminado las preguntas contextuales y se han estandarizado las fórmulas según lo solicitado.

        const questionDatabase = {

	magnitudes: [
        { 
            type: 'theory', 
            question: '¿Cuál de las siguientes es una magnitud escalar?', 
            options: ['Velocidad', 'Aceleración', 'Temperatura', 'Fuerza'], 
            correct: 2, 
            explanation: 'La temperatura es una magnitud escalar porque se define completamente con un número y una unidad, sin necesidad de una dirección.', 
            difficulty: 1 
        },
        { 
            type: 'theory', 
            question: '¿Qué caracteriza a una magnitud vectorial?', 
            options: ['Solo tiene magnitud', 'Tiene magnitud, dirección y sentido', 'Solo tiene dirección', 'No tiene unidades'], 
            correct: 1, 
            explanation: 'Las magnitudes vectoriales como la fuerza o la velocidad necesitan magnitud (un valor numérico), dirección (la línea sobre la que actúan) y sentido (hacia dónde apuntan en esa línea).', 
            difficulty: 1 
        },
        { 
            type: 'theory', 
            question: 'La masa de un objeto es un ejemplo de magnitud:', 
            options: ['Vectorial', 'Escalar', 'Fundamental', 'Derivada'], 
            correct: 1, 
            explanation: 'La masa es la medida de la inercia de un cuerpo y es una magnitud puramente escalar, ya que no tiene dirección ni sentido.', 
            difficulty: 1 
        },
        { 
            type: 'theory', 
            question: 'El desplazamiento se diferencia de la distancia en que es una magnitud:', 
            options: ['Escalar', 'Vectorial', 'Siempre positiva', 'Adimensional'], 
            correct: 1, 
            explanation: 'El desplazamiento es un vector que une el punto inicial con el final, mientras que la distancia es la longitud total del camino recorrido, que es un escalar.', 
            difficulty: 2 
        },
        { 
            type: 'theory', 
            question: '¿Cuál de estas NO es una magnitud vectorial?', 
            options: ['Desplazamiento', 'Campo Eléctrico', 'Energía Cinética', 'Torque'], 
            correct: 2, 
            explanation: 'La energía cinética ($$E_c = \\frac{1}{2}mv^2$$) es una magnitud escalar. Aunque depende de la velocidad, lo hace a través de su módulo al cuadrado ($$v^2$$), perdiendo la información direccional.', 
            difficulty: 2 
        },
        { 
            type: 'theory', 
            question: 'El peso de un objeto es:', 
            options: ['Una magnitud escalar', 'Una magnitud vectorial', 'Una propiedad intrínseca', 'Igual a la masa'], 
            correct: 1, 
            explanation: 'El peso es la fuerza con la que la gravedad atrae a un objeto ($$ \\vec{P} = m \\cdot \\vec{g} $$). Al ser una fuerza, es vectorial y siempre apunta hacia el centro del planeta.', 
            difficulty: 2 
        },
        { 
            type: 'theory', 
            question: 'La rapidez (o celeridad) es el módulo de la velocidad. Por lo tanto, la rapidez es una magnitud:', 
            options: ['Vectorial', 'Escalar', 'Negativa', 'Nula'], 
            correct: 1, 
            explanation: 'La rapidez es la magnitud del vector velocidad, por lo que es un escalar. Un coche puede tener una rapidez constante mientras su velocidad (vectorial) cambia al tomar una curva.', 
            difficulty: 2 
        },
        { 
            type: 'theory', 
            question: 'El trabajo realizado por una fuerza ($$ W = \\vec{F} \\cdot \\vec{d} $$) es una magnitud:', 
            options: ['Vectorial', 'Escalar', 'Adimensional', 'Fundamental'], 
            correct: 1, 
            explanation: 'El trabajo es una magnitud escalar que se obtiene del producto escalar (o producto punto) de dos vectores: la fuerza y el desplazamiento. El resultado de un producto escalar es siempre un escalar.', 
            difficulty: 2 
        },
        { 
            type: 'theory', 
            question: '¿Cuál de las siguientes es una magnitud fundamental en el Sistema Internacional?', 
            options: ['Velocidad', 'Fuerza', 'Cantidad de sustancia', 'Energía'], 
            correct: 2, 
            explanation: 'La cantidad de sustancia, medida en moles (mol), es una de las siete magnitudes fundamentales del SI. Las otras son longitud, masa, tiempo, temperatura, intensidad de corriente e intensidad luminosa.', 
            difficulty: 3 
        },
        { 
            type: 'theory', 
            question: 'El momento lineal o cantidad de movimiento ($$\\vec{p}=m\\vec{v}$$) es una magnitud:', 
            options: ['Escalar', 'Vectorial', 'Adimensional', 'Constante universal'], 
            correct: 1, 
            explanation: 'El momento lineal es una magnitud vectorial, ya que resulta del producto de un escalar (masa) por un vector (velocidad), y tiene la misma dirección y sentido que la velocidad.', 
            difficulty: 2 
        },
        { 
            type: 'theory', 
            question: 'La densidad de un material ($$\\rho = m/V$$) es una magnitud:', 
            options: ['Vectorial', 'Escalar', 'Adimensional', 'Relativa'], 
            correct: 1, 
            explanation: 'La densidad se define como la masa por unidad de volumen. Ambas, masa y volumen, son escalares, por lo tanto, la densidad también lo es.', 
            difficulty: 1 
        },
        { 
            type: 'theory', 
            question: '¿Cuál de los siguientes grupos contiene únicamente magnitudes vectoriales?', 
            options: ['Masa, tiempo, fuerza', 'Velocidad, aceleración, desplazamiento', 'Energía, trabajo, potencia', 'Temperatura, presión, densidad'], 
            correct: 1, 
            explanation: 'La velocidad, la aceleración y el desplazamiento son ejemplos clásicos de magnitudes que requieren una dirección y un sentido para ser completamente descritas.', 
            difficulty: 3 
        },
        { 
            type: 'theory', 
            question: 'La presión que ejerce un gas sobre las paredes de un recipiente es una magnitud:', 
            options: ['Vectorial', 'Escalar', 'Tensorial de rango 2', 'Nula'], 
            correct: 1, 
            explanation: 'Aunque la fuerza que ejerce el gas sobre un punto de la pared es un vector, la presión se define como una magnitud escalar (fuerza por unidad de área).', 
            difficulty: 2 
        },
        { 
            type: 'theory', 
            question: 'La potencia, que mide la rapidez con que se realiza un trabajo, es una magnitud:', 
            options: ['Vectorial', 'Escalar', 'Nula', 'Negativa'], 
            correct: 1, 
            explanation: 'La potencia es la cantidad de trabajo (energía) por unidad de tiempo ($$ P = W/t $$). Es una magnitud escalar.', 
            difficulty: 2 
        },
        { 
            type: 'theory', 
            question: 'El campo eléctrico ($$\\vec{E}$$) en un punto del espacio es una magnitud:', 
            options: ['Escalar', 'Vectorial', 'Potencial', 'Adimensional'], 
            correct: 1, 
            explanation: 'El campo eléctrico es una magnitud vectorial. En cada punto del espacio, define la fuerza que actuaría sobre una carga de prueba unitaria, por lo que tiene magnitud y dirección.', 
            difficulty: 3 
        }
    ],


si: [
        { 
            type: 'theory', 
            question: '¿Cuál es la unidad de la fuerza en el Sistema Internacional (SI)?', 
            options: ['Dina', 'Newton', 'Libra', 'Pascal'], 
            correct: 1, 
            explanation: 'El Newton (N) es la unidad derivada para la fuerza en el SI. Se define como $$ 1 \\, N = 1 \\, kg \\cdot m/s^2 $$.', 
            difficulty: 1 
        },
        { 
            type: 'calculation', 
            question: 'Convierte 2.5 kilómetros a metros.', 
            options: ['25 m', '250 m', '2500 m', '0.025 m'], 
            correct: 2, 
            explanation: 'El prefijo "kilo" (k) significa 1000. Por lo tanto, $$ 2.5 \\, km = 2.5 \\cdot 1000 \\, m = 2500 \\, m $$.', 
            difficulty: 1 
        },
        { 
            type: 'theory', 
            question: '¿Cuál es la unidad de energía o trabajo en el SI?', 
            options: ['Caloría', 'Ergio', 'Joule', 'Vatio'], 
            correct: 2, 
            explanation: 'El Joule (J) es la unidad de energía, trabajo y calor en el SI. El Vatio (W) es la unidad de potencia (energía por unidad de tiempo).', 
            difficulty: 1 
        },
        { 
            type: 'theory', 
            question: '¿Cuál de las siguientes NO es una de las 7 unidades fundamentales del SI?', 
            options: ['Metro (m)', 'Amperio (A)', 'Newton (N)', 'Segundo (s)'], 
            correct: 2, 
            explanation: 'El Newton (N) es una unidad derivada ($$kg \\cdot m/s^2$$). Las 7 fundamentales son: metro, kilogramo, segundo, amperio, kelvin, mol y candela.', 
            difficulty: 2 
        },
        { 
            type: 'calculation', 
            question: 'Un coche se mueve a 72 km/h. ¿Cuál es su velocidad en m/s?', 
            options: ['20 m/s', '25 m/s', '36 m/s', '15 m/s'], 
            correct: 0, 
            explanation: 'Para convertir km/h a m/s, se multiplica por 1000 y se divide por 3600. $$ 72 \\, \\frac{km}{h} \\cdot \\frac{1000 \\, m}{1 \\, km} \\cdot \\frac{1 \\, h}{3600 \\, s} = 20 \\, \\frac{m}{s} $$.', 
            difficulty: 2 
        },
        { 
            type: 'theory', 
            question: 'La presión se mide en Pascales (Pa) en el SI. ¿A qué equivale un Pascal?', 
            options: ['$$ N \\cdot m^2 $$', '$$ J / m^3 $$', '$$ kg / m^2 $$', '$$ N / m^2 $$'], 
            correct: 3, 
            explanation: 'La presión es la fuerza aplicada por unidad de área ($$ P = F/A $$), por lo tanto, su unidad es Newton por metro cuadrado ($$ N/m^2 $$).', 
            difficulty: 3 
        },
        { 
            type: 'theory', 
            question: '¿Cuál es la unidad de temperatura termodinámica en el SI, usada en la mayoría de fórmulas científicas?', 
            options: ['Grado Celsius', 'Grado Fahrenheit', 'Kelvin', 'Grado Rankine'], 
            correct: 2, 
            explanation: 'La unidad fundamental de temperatura en el SI es el Kelvin (K). A diferencia de los grados Celsius o Fahrenheit, el Kelvin es una escala absoluta donde 0 K representa el cero absoluto.', 
            difficulty: 2 
        },
        { 
            type: 'calculation', 
            question: 'Convierte 1500 gramos a kilogramos.', 
            options: ['150 kg', '15 kg', '1.5 kg', '0.15 kg'], 
            correct: 2, 
            explanation: 'Sabiendo que 1 kilogramo equivale a 1000 gramos, la conversión es: $$ 1500 \\, g \\cdot \\frac{1 \\, kg}{1000 \\, g} = 1.5 \\, kg $$.', 
            difficulty: 1 
        },
        { 
            type: 'theory', 
            question: 'El prefijo "mili" (m), como en milímetro, representa un factor de:', 
            options: ['$$10^{-6}$$', '$$10^{-3}$$', '$$10^{3}$$', '$$10^{-2}$$'], 
            correct: 1, 
            explanation: 'El prefijo "mili" representa la milésima parte de una unidad, es decir, un factor de $$10^{-3}$$. Por ejemplo, 1 mm = 0.001 m.', 
            difficulty: 2 
        },
        { 
            type: 'theory', 
            question: 'La unidad de frecuencia en el SI es el Hertz (Hz). ¿A qué es equivalente?', 
            options: ['$$s$$', '$$s^{-1}$$', '$$rad/s$$', '$$m/s$$'], 
            correct: 1, 
            explanation: 'La frecuencia mide el número de ciclos u oscilaciones por segundo. Por lo tanto, 1 Hertz es equivalente a 1 ciclo por segundo, o $$s^{-1}$$.', 
            difficulty: 2 
        },
        { 
            type: 'calculation', 
            question: 'La densidad del agua es $$1 \\, g/cm^3$$. ¿Cuál es su valor en la unidad del SI ($$kg/m^3$$)?', 
            options: ['$$1 \\, kg/m^3$$', '$$10 \\, kg/m^3$$', '$$100 \\, kg/m^3$$', '$$1000 \\, kg/m^3$$'], 
            correct: 3, 
            explanation: 'La conversión requiere dos pasos: $$1 \\, \\frac{g}{cm^3} \\cdot \\frac{1 \\, kg}{1000 \\, g} \\cdot \\frac{(100 \\, cm)^3}{(1 \\, m)^3} = \\frac{1}{1000} \\cdot 1000000 \\, \\frac{kg}{m^3} = 1000 \\, \\frac{kg}{m^3}$$.', 
            difficulty: 3 
        },
        { 
            type: 'theory', 
            question: '¿Cuál es el símbolo correcto para la unidad de masa fundamental del SI?', 
            options: ['g', 'gr', 'Kg', 'kg'], 
            correct: 3, 
            explanation: 'El kilogramo es la unidad fundamental de masa. Su símbolo oficial es "kg", con la "k" minúscula. "Kg" con mayúscula es incorrecto.', 
            difficulty: 2 
        },
        { 
            type: 'theory', 
            question: 'La unidad de potencia en el SI es el Vatio (W). ¿A qué es equivalente?', 
            options: ['$$J \\cdot s$$', '$$N / s$$', '$$J / s$$', '$$N \\cdot m$$'], 
            correct: 2, 
            explanation: 'La potencia es la energía transferida por unidad de tiempo. Por lo tanto, un Vatio (Watt) es igual a un Joule por segundo ($$J/s$$).', 
            difficulty: 2 
        },
        { 
            type: 'calculation', 
            question: 'Un área mide 200 $$cm^2$$. ¿Cuál es su valor en $$m^2$$?', 
            options: ['$$0.02 \\, m^2$$', '$$0.2 \\, m^2$$', '$$2 \\, m^2$$', '$$0.002 \\, m^2$$'], 
            correct: 0, 
            explanation: 'Sabemos que $$1 \\, m = 100 \\, cm$$. Al elevar al cuadrado, $$1 \\, m^2 = (100 \\, cm)^2 = 10000 \\, cm^2$$. Por lo tanto, $$200 \\, cm^2 \\cdot \\frac{1 \\, m^2}{10000 \\, cm^2} = 0.02 \\, m^2$$.', 
            difficulty: 3 
        },
        { 
            type: 'theory', 
            question: 'El prefijo "Mega" (M), como en Megavatios (MW), representa un factor de:', 
            options: ['$$10^3$$', '$$10^9$$', '$$10^6$$', '$$10^{-6}$$'], 
            correct: 2, 
            explanation: 'El prefijo "Mega" representa un millón, es decir, un factor de $$10^6$$. Por ejemplo, 1 MW = 1,000,000 W.', 
            difficulty: 2 
        }
    ],


cinematica: [
        { 
            type: 'theory', 
            question: '¿Qué estudia la cinemática?', 
            options: ['Las causas que provocan el movimiento', 'La descripción del movimiento sin atender a sus causas', 'El equilibrio estático de los cuerpos', 'La energía asociada al movimiento'], 
            correct: 1, 
            explanation: 'La cinemática es la rama de la mecánica que describe el movimiento (posición, velocidad, aceleración) sin considerar las fuerzas que lo originan.', 
            difficulty: 1 
        },
        { 
            type: 'theory', 
            question: 'Un coche da una vuelta completa a una pista circular y vuelve a su punto de partida. ¿Cuál es su desplazamiento total?', 
            options: ['La longitud de la pista', 'La mitad de la longitud de la pista', 'Cero', 'No se puede determinar'], 
            correct: 2, 
            explanation: 'El desplazamiento es el vector que une la posición inicial y final. Si el punto inicial y final son el mismo, el vector desplazamiento es nulo (cero), aunque la distancia recorrida sea la longitud de la pista.', 
            difficulty: 2 
        },
        { 
            type: 'theory', 
            question: 'La aceleración se define como:', 
            options: ['El cambio de posición en el tiempo', 'La distancia total recorrida por unidad de tiempo', 'El cambio de velocidad en el tiempo', 'La velocidad máxima alcanzada'], 
            correct: 2, 
            explanation: 'La aceleración es una magnitud vectorial que describe la tasa de cambio de la velocidad por unidad de tiempo. $$ \\vec{a} = \\frac{\\Delta\\vec{v}}{\\Delta t} $$.', 
            difficulty: 1 
        },
        { 
            type: 'theory', 
            question: 'En una gráfica de posición vs. tiempo (x-t), la pendiente de la línea recta representa:', 
            options: ['La aceleración', 'La posición inicial', 'La velocidad', 'El tiempo transcurrido'], 
            correct: 2, 
            explanation: 'La pendiente de la gráfica x-t ($$\\frac{\\Delta x}{\\Delta t}$$) representa la velocidad media. Si la gráfica es una recta, la velocidad es constante.', 
            difficulty: 2 
        },
        { 
            type: 'theory', 
            question: 'En una gráfica de velocidad vs. tiempo (v-t), el área bajo la curva representa:', 
            options: ['La aceleración media', 'La velocidad media', 'La posición final', 'El desplazamiento'], 
            correct: 3, 
            explanation: 'El área bajo la curva v-t representa el desplazamiento total del objeto, ya que corresponde a la integral de la velocidad respecto al tiempo ($$\\Delta x = \\int v(t) dt$$).', 
            difficulty: 3 
        },
        { 
            type: 'calculation', 
            question: 'Un explorador camina 3 km hacia el Norte y luego 4 km hacia el Este. ¿Cuál es el módulo de su desplazamiento?', 
            options: ['7 km', '1 km', '5 km', '12 km'], 
            correct: 2, 
            explanation: 'Los dos trayectos forman un triángulo rectángulo. El módulo del desplazamiento es la hipotenusa. Usando el teorema de Pitágoras: $$d = \\sqrt{3^2 + 4^2} = \\sqrt{9 + 16} = \\sqrt{25} = 5 \\, km$$.', 
            difficulty: 2 
        },
        { 
            type: 'theory', 
            question: '¿Qué es la trayectoria de un móvil?', 
            options: ['La distancia que recorre', 'El vector que une el inicio y el final del movimiento', 'La línea geométrica que describe el móvil al moverse', 'La velocidad media del móvil'], 
            correct: 2, 
            explanation: 'La trayectoria es el conjunto de todos los puntos por los que pasa un cuerpo en movimiento. Puede ser una línea recta, una curva, etc.', 
            difficulty: 1 
        },
        { 
            type: 'theory', 
            question: 'Si un coche frena para detenerse, su vector de aceleración tiene:', 
            options: ['El mismo sentido que la velocidad', 'Sentido opuesto a la velocidad', 'Dirección perpendicular a la velocidad', 'Módulo cero'], 
            correct: 1, 
            explanation: 'Al frenar, la velocidad disminuye. Esto significa que el vector aceleración tiene un sentido opuesto al vector velocidad, causando una desaceleración.', 
            difficulty: 2 
        },
        { 
            type: 'theory', 
            question: '¿En cuál de estos casos un cuerpo tiene aceleración?', 
            options: ['Un coche en reposo', 'Un tren viajando en línea recta a 100 km/h constantes', 'Un satélite en órbita circular alrededor de la Tierra', 'Un ascensor subiendo con velocidad constante'], 
            correct: 2, 
            explanation: 'Un satélite en órbita circular, aunque su rapidez sea constante, está acelerado porque la dirección de su vector velocidad cambia continuamente. Esta es la aceleración centrípeta.', 
            difficulty: 3 
        },
        { 
            type: 'theory', 
            question: 'La velocidad instantánea se define como:', 
            options: ['La velocidad media durante todo el viaje', 'El desplazamiento total dividido por el tiempo total', 'La velocidad de un cuerpo en un instante de tiempo específico', 'La máxima velocidad que alcanza un cuerpo'], 
            correct: 2, 
            explanation: 'La velocidad instantánea es el límite de la velocidad media cuando el intervalo de tiempo tiende a cero. Es la derivada de la posición respecto al tiempo ($$\\vec{v} = dr/dt$$).', 
            difficulty: 2 
        },
        { 
            type: 'theory', 
            question: 'En una gráfica de velocidad vs. tiempo (v-t), la pendiente de la línea representa:', 
            options: ['La posición', 'El desplazamiento', 'La rapidez', 'La aceleración'], 
            correct: 3, 
            explanation: 'La pendiente de la gráfica v-t ($$\\frac{\\Delta v}{\\Delta t}$$) representa la tasa de cambio de la velocidad, que por definición es la aceleración.', 
            difficulty: 2 
        },
        { 
            type: 'calculation', 
            question: 'Un objeto se mueve desde la posición $$x_i = 10$$ m hasta $$x_f = -5$$ m. ¿Cuál es su desplazamiento ($$\\Delta x$$)?', 
            options: ['15 m', '-15 m', '5 m', '-5 m'], 
            correct: 1, 
            explanation: 'El desplazamiento se calcula como la posición final menos la posición inicial: $$\\Delta x = x_f - x_i = (-5 \\, m) - (10 \\, m) = -15 \\, m$$.', 
            difficulty: 2 
        },
        { 
            type: 'theory', 
            question: 'El concepto de "movimiento" es relativo. ¿Qué significa esto?', 
            options: ['Que el movimiento no se puede medir con precisión', 'Que la descripción del movimiento depende del sistema de referencia del observador', 'Que solo los objetos grandes se mueven', 'Que el movimiento siempre sigue una línea recta'], 
            correct: 1, 
            explanation: 'La descripción de la posición, velocidad y trayectoria de un objeto depende del punto de vista o sistema de referencia que se elija. Alguien en un tren en movimiento está en reposo respecto al tren, pero en movimiento respecto a alguien en el andén.', 
            difficulty: 2 
        },
        { 
            type: 'theory', 
            question: 'En una gráfica de posición vs. tiempo (x-t), una curva (no una recta) indica que:', 
            options: ['El objeto está en reposo', 'El objeto se mueve con velocidad constante', 'La velocidad del objeto está cambiando (hay aceleración)', 'El objeto ha regresado a su origen'], 
            correct: 2, 
            explanation: 'Una línea recta en una gráfica x-t significa velocidad constante. Si la línea es curva, la pendiente está cambiando, lo que significa que la velocidad está cambiando, y por lo tanto, hay aceleración.', 
            difficulty: 3 
        },
        { 
            type: 'calculation', 
            question: 'Un coche viaja 120 km en 2 horas. ¿Cuál es su rapidez media?', 
            options: ['120 km/h', '240 km/h', '60 km/h', '0.016 km/h'], 
            correct: 2, 
            explanation: 'La rapidez media se calcula como la distancia total recorrida dividida por el tiempo total empleado. Rapidez media = $$ \\frac{120 \\, km}{2 \\, h} = 60 \\, km/h$$.', 
            difficulty: 1 
        }
    ],


mru: [
        { 
            type: 'theory', 
            question: '¿Cuál es la característica principal del Movimiento Rectilíneo Uniforme (MRU)?', 
            options: ['La aceleración es constante y positiva', 'La velocidad es constante', 'La distancia recorrida es siempre cero', 'La aceleración varía con el tiempo'], 
            correct: 1, 
            explanation: 'En un MRU, un objeto se mueve en línea recta a velocidad constante, lo que significa que su magnitud (rapidez) y dirección no cambian. Por lo tanto, su aceleración es cero.', 
            difficulty: 1 
        },
        { 
            type: 'calculation', 
            question: 'Un tren viaja a una velocidad constante de 90 km/h. ¿Qué distancia recorre en 2 horas?', 
            formula: '$$x = v \\cdot t$$',
            given: { v: 90, t: 2 }, 
            options: ['45 km', '92 km', '180 km', '90 km'], 
            correct: 2, 
            explanation: 'Usando la fórmula del MRU, la distancia es el producto de la velocidad y el tiempo: $$ x = 90 \\, km/h \\cdot 2 \\, h = 180 \\, km $$.', 
            difficulty: 1 
        },
        { 
            type: 'theory', 
            question: 'La gráfica de posición vs. tiempo (x-t) para un MRU es siempre:', 
            options: ['Una parábola', 'Una línea horizontal', 'Una línea recta con pendiente', 'Una curva exponencial'], 
            correct: 2, 
            explanation: 'En un MRU, la posición cambia linealmente con el tiempo ($$x = x_o + v \\cdot t$$), lo que resulta en una línea recta en la gráfica x-t. La pendiente de la recta es la velocidad constante.', 
            difficulty: 2 
        },
        { 
            type: 'theory', 
            question: 'La gráfica de velocidad vs. tiempo (v-t) para un MRU es siempre:', 
            options: ['Una línea recta con pendiente positiva', 'Una línea recta con pendiente negativa', 'Una línea horizontal no nula', 'Una parábola'], 
            correct: 2, 
            explanation: 'En un MRU, la velocidad es constante, por lo que su valor no cambia con el tiempo. Esto se representa como una línea horizontal en la gráfica v-t.', 
            difficulty: 2 
        },
        { 
            type: 'calculation', 
            question: 'Un coche se mueve con MRU a 15 m/s. Si parte de la posición $$x_o = 10$$ m, ¿cuál será su posición final después de 5 segundos?', 
            formula: '$$x = x_o + v \\cdot t$$',
            given: { x_o: 10, v: 15, t: 5 }, 
            options: ['75 m', '65 m', '85 m', '25 m'], 
            correct: 2, 
            explanation: 'Aplicando la ecuación de posición completa: $$ x = 10 \\, m + (15 \\, m/s \\cdot 5 \\, s) = 10 + 75 = 85 \\, m $$.', 
            difficulty: 2 
        },
        { 
            type: 'calculation', 
            question: 'La luz del Sol tarda aproximadamente 8.3 minutos en llegar a la Tierra. Si la velocidad de la luz es $$3 \\cdot 10^8$$ m/s, ¿cuál es la distancia aproximada entre la Tierra y el Sol?', 
            formula: '$$x = v \\cdot t$$',
            given: { v: '3 \\cdot 10^8', t_min: 8.3 }, 
            options: ['150 millones de km', '25 millones de km', '500 millones de km', '1.5 millones de km'], 
            correct: 0, 
            explanation: 'Primero, convierte el tiempo a segundos: $$ t = 8.3 \\, min \\cdot 60 \\, s/min = 498 \\, s $$. Luego, calcula la distancia: $$ x = (3 \\cdot 10^8 \\, m/s) \\cdot 498 \\, s \\approx 1.494 \\cdot 10^{11} \\, m $$, que son aproximadamente 150 millones de kilómetros.', 
            difficulty: 3 
        },
        { 
            type: 'theory', 
            question: 'En un MRU, si no hay cambio de sentido, ¿cómo se relacionan la distancia recorrida y el módulo del desplazamiento?', 
            options: ['La distancia es mayor', 'El desplazamiento es mayor', 'Son iguales', 'No tienen relación'], 
            correct: 2, 
            explanation: 'En un movimiento rectilíneo que siempre ocurre en el mismo sentido, la longitud del camino recorrido (distancia) es exactamente igual al módulo del vector desplazamiento.', 
            difficulty: 2 
        },
        { 
            type: 'calculation', 
            question: 'Un sonido viaja en el aire a 340 m/s. Si ves un relámpago y escuchas el trueno 4 segundos después, ¿a qué distancia está la tormenta?', 
            formula: '$$x = v \\cdot t$$',
            given: { v: 340, t: 4 }, 
            options: ['85 m', '344 m', '680 m', '1360 m'], 
            correct: 3, 
            explanation: 'Asumiendo que la luz del relámpago llega instantáneamente, la distancia se calcula como: $$ x = 340 \\, m/s \\cdot 4 \\, s = 1360 \\, m $$ o 1.36 km.', 
            difficulty: 1 
        },
        { 
            type: 'calculation', 
            question: 'Un coche parte de la posición $$x_o=100$$ m con una velocidad de $$-10$$ m/s. ¿Cuál es su posición a los 3 segundos?', 
            formula: '$$x = x_o + v \\cdot t$$',
            given: { x_o: 100, v: -10, t: 3 }, 
            options: ['130 m', '70 m', '30 m', '-30 m'], 
            correct: 1, 
            explanation: 'La velocidad negativa indica que se mueve en sentido contrario al positivo del eje. $$ x = 100 + (-10 \\cdot 3) = 100 - 30 = 70 \\, m $$.', 
            difficulty: 2 
        },
        { 
            type: 'theory', 
            question: '¿Qué representa el área bajo la gráfica velocidad-tiempo (v-t) en un MRU durante un intervalo de 3 segundos?', 
            options: ['La aceleración', 'La velocidad final', 'El desplazamiento en esos 3 s', 'La posición inicial'], 
            correct: 2, 
            explanation: 'El área bajo la curva v-t siempre representa el desplazamiento. En un MRU, esta área es un rectángulo de base (tiempo) y altura (velocidad).', 
            difficulty: 2 
        },
        { 
            type: 'calculation', 
            question: 'Un atleta corre una pista de 400 m en 50 segundos con velocidad constante. ¿Cuál es su rapidez?', 
            formula: '$$v = x / t$$',
            given: { x: 400, t: 50 }, 
            options: ['4 m/s', '8 m/s', '10 m/s', '5 m/s'], 
            correct: 1, 
            explanation: 'La rapidez se calcula como la distancia dividida por el tiempo. $$ v = \\frac{400 \\, m}{50 \\, s} = 8 \\, m/s $$.', 
            difficulty: 1 
        },
        { 
            type: 'calculation', 
            question: 'Dos coches separados por 200 km parten al mismo tiempo para encontrarse. El coche A va a 40 km/h y el B a 60 km/h. ¿En cuánto tiempo se encuentran?', 
            formula: '$$t_{encuentro} = \\frac{d}{v_A + v_B}$$',
            given: { d: 200, v_A: 40, v_B: 60 }, 
            options: ['1 h', '2 h', '4 h', '5 h'], 
            correct: 1, 
            explanation: 'La velocidad relativa de acercamiento es la suma de sus velocidades: $$v_r = 40 + 60 = 100 \\, km/h$$. El tiempo de encuentro es $$t = \\frac{d}{v_r} = \\frac{200 \\, km}{100 \\, km/h} = 2 \\, horas$$.', 
            difficulty: 3 
        },
        { 
            type: 'theory', 
            question: 'Si la gráfica x-t de un móvil es una línea horizontal en $$x=20$$ m, significa que el móvil:', 
            options: ['Se mueve con v=20 m/s', 'Acelera a 20 m/s²', 'Está en reposo en la posición 20 m', 'Se mueve hacia atrás'], 
            correct: 2, 
            explanation: 'Una línea horizontal en la gráfica x-t significa que la posición no cambia con el tiempo, por lo tanto, el objeto está en reposo (velocidad cero).', 
            difficulty: 2 
        },
        { 
            type: 'calculation', 
            question: 'Un ascensor sube 30 metros en 15 segundos con velocidad constante. ¿Cuál es su velocidad?', 
            formula: '$$v = x/t$$',
            given: { x: 30, t: 15 }, 
            options: ['2 m/s', '0.5 m/s', '3 m/s', '450 m/s'], 
            correct: 0, 
            explanation: 'La velocidad se calcula como el desplazamiento dividido por el tiempo: $$ v = \\frac{30 \\, m}{15 \\, s} = 2 \\, m/s $$.', 
            difficulty: 1 
        },
        { 
            type: 'theory', 
            question: 'La aceleración en cualquier MRU es siempre:', 
            options: ['Positiva', 'Negativa', 'Nula', 'Igual a la gravedad'], 
            correct: 2, 
            explanation: 'Por definición, el Movimiento Rectilíneo Uniforme ocurre a velocidad constante, lo que implica que no hay cambio en la velocidad y, por lo tanto, la aceleración es siempre cero.', 
            difficulty: 1 
        }
    ],

mrua: [
        { 
            type: 'theory', 
            question: 'En un MRUA, ¿qué magnitud permanece constante durante todo el movimiento?', 
            options: ['La velocidad', 'La posición', 'La aceleración', 'El desplazamiento'], 
            correct: 2, 
            explanation: 'La característica que define al Movimiento Rectilíneo Uniformemente Acelerado (MRUA) es que la aceleración es constante y no nula.', 
            difficulty: 1 
        },
        { 
            type: 'calculation', 
            question: 'Un coche parte del reposo y acelera a $$ 2 \\, m/s^2 $$. ¿Qué velocidad alcanza después de 5 segundos?', 
            formula: '$$v_f = v_o + a \\cdot t$$',
            given: { v_o: 0, a: 2, t: 5 }, 
            options: ['5 m/s', '7 m/s', '10 m/s', '2.5 m/s'], 
            correct: 2, 
            explanation: 'Como parte del reposo, $$ v_o = 0 $$. Usando la fórmula: $$ v_f = 0 + (2 \\, m/s^2 \\cdot 5 \\, s) = 10 \\, m/s $$.', 
            difficulty: 1 
        },
        { 
            type: 'theory', 
            question: 'La gráfica de posición vs. tiempo (x-t) para un MRUA es una:', 
            options: ['Línea recta inclinada', 'Línea recta horizontal', 'Parábola', 'Hipérbola'], 
            correct: 2, 
            explanation: 'La ecuación de posición $$x = x_o + v_ot + \\frac{1}{2}at^2$$ es una función cuadrática del tiempo, lo que corresponde gráficamente a una parábola.', 
            difficulty: 2 
        },
        { 
            type: 'theory', 
            question: 'La pendiente de la gráfica velocidad-tiempo (v-t) en un MRUA representa:', 
            options: ['La posición', 'La velocidad media', 'La aceleración', 'El desplazamiento'], 
            correct: 2, 
            explanation: 'La pendiente ($$\\Delta v / \\Delta t$$) de la gráfica v-t representa la tasa de cambio de la velocidad, que es la definición de aceleración. En un MRUA, esta pendiente es constante.', 
            difficulty: 2 
        },
        { 
            type: 'calculation', 
            question: 'Un objeto parte del reposo y acelera a $$ 4 \\, m/s^2 $$. ¿Qué distancia recorre en 3 segundos?', 
            formula: '$$x = v_o \\cdot t + \\frac{a \\cdot t^2}{2}$$',
            given: { v_o: 0, a: 4, t: 3 }, 
            options: ['12 m', '18 m', '9 m', '36 m'], 
            correct: 1, 
            explanation: 'Como $$v_o = 0$$, la fórmula se simplifica. Sustituyendo: $$ x = 0 \\cdot 3 + \\frac{4 \\cdot (3)^2}{2} = \\frac{4 \\cdot 9}{2} = 18 \\, m $$.', 
            difficulty: 2 
        },
        { 
            type: 'calculation', 
            question: 'Un coche que va a 30 m/s frena con una aceleración de $$ -5 \\, m/s^2 $$. ¿Cuánto tiempo tarda en detenerse?', 
            formula: '$$v_f = v_o + a \\cdot t$$',
            given: { v_o: 30, v_f: 0, a: -5 }, 
            options: ['5 s', '150 s', '6 s', '10 s'], 
            correct: 2, 
            explanation: 'Detenerse significa $$v_f = 0$$. Despejamos el tiempo de la fórmula: $$ t = \\frac{v_f - v_o}{a} = \\frac{0 - 30}{-5} = 6 \\, s $$.', 
            difficulty: 2 
        },
        { 
            type: 'calculation', 
            question: 'Un avión necesita alcanzar una velocidad de 100 m/s para despegar. Si parte del reposo y su aceleración es de $$ 5 \\, m/s^2 $$, ¿qué distancia de pista necesita?', 
            formula: '$$v_f^2 = v_o^2 + 2 a x$$',
            given: { v_f: 100, v_o: 0, a: 5 }, 
            options: ['1000 m', '2000 m', '500 m', '100 m'], 
            correct: 0, 
            explanation: 'Usamos la ecuación de Torricelli. Despejando la distancia x: $$ x = \\frac{v_f^2 - v_o^2}{2a} = \\frac{100^2 - 0^2}{2 \\cdot 5} = \\frac{10000}{10} = 1000 \\, m $$.', 
            difficulty: 3 
        },
        { 
            type: 'theory', 
            question: 'Si un objeto tiene velocidad positiva y aceleración negativa, el objeto está...', 
            options: ['Aumentando su rapidez', 'Disminuyendo su rapidez (frenando)', 'Moviéndose a velocidad constante', 'En reposo'], 
            correct: 1, 
            explanation: 'Cuando los vectores velocidad y aceleración tienen sentidos opuestos, el módulo de la velocidad disminuye, es decir, el objeto está frenando o desacelerando.', 
            difficulty: 2 
        },
        { 
            type: 'calculation', 
            question: 'Un tren viaja a 10 m/s y acelera a $$ 2 \\, m/s^2 $$ durante 8 segundos. ¿Cuál es su velocidad final?', 
            formula: '$$v_f = v_o + a \\cdot t$$',
            given: { v_o: 10, a: 2, t: 8 }, 
            options: ['16 m/s', '20 m/s', '26 m/s', '30 m/s'], 
            correct: 2, 
            explanation: 'Usando la fórmula de velocidad final: $$ v_f = v_o + a \\cdot t = 10 \\, m/s + (2 \\, m/s^2 \\cdot 8 \\, s) = 10 + 16 = 26 \\, m/s $$.', 
            difficulty: 2 
        },
        { 
            type: 'calculation', 
            question: 'Un coche pasa de 10 m/s a 30 m/s en 4 segundos. ¿Qué distancia recorre en ese tiempo?', 
            formula: '$$x = \\frac{(v_f + v_o)t}{2}$$',
            given: { v_o: 10, v_f: 30, t: 4 }, 
            options: ['40 m', '60 m', '80 m', '160 m'], 
            correct: 2, 
            explanation: 'Podemos usar la fórmula del desplazamiento con la velocidad media: $$ x = \\frac{(30 + 10)}{2} \\cdot 4 = \\frac{40}{2} \\cdot 4 = 20 \\cdot 4 = 80 \\, m $$.', 
            difficulty: 2 
        },
        { 
            type: 'theory', 
            question: 'La gráfica aceleración-tiempo (a-t) para un MRUA es:', 
            options: ['Una línea horizontal', 'Una línea con pendiente', 'Una parábola', 'Una línea vertical'], 
            correct: 0, 
            explanation: 'Como la aceleración es constante en un MRUA, su valor no cambia con el tiempo. Esto se representa como una línea horizontal en la gráfica a-t.', 
            difficulty: 2 
        },
        { 
            type: 'calculation', 
            question: 'Un móvil acelera desde el reposo y recorre 100 m en 5 s. ¿Cuál fue su aceleración?', 
            formula: '$$x = v_o t + \\frac{1}{2}at^2$$',
            given: { x: 100, t: 5, v_o: 0 }, 
            options: ['4 m/s²', '10 m/s²', '8 m/s²', '20 m/s²'], 
            correct: 2, 
            explanation: 'Partiendo del reposo ($$v_o=0$$), despejamos la aceleración de la fórmula de desplazamiento: $$ a = \\frac{2x}{t^2} = \\frac{2 \\cdot 100}{5^2} = \\frac{200}{25} = 8 \\, m/s^2 $$.', 
            difficulty: 3 
        },
        { 
            type: 'theory', 
            question: 'En un MRUA, la velocidad media durante un intervalo de tiempo es igual a:', 
            options: ['La velocidad instantánea final', 'La velocidad instantánea inicial', 'La media aritmética de la velocidad inicial y final', 'La aceleración por el tiempo'], 
            correct: 2, 
            explanation: 'Para un movimiento con aceleración constante, la velocidad media durante un intervalo se puede calcular como el promedio de la velocidad inicial y final: $$ \\bar{v} = \\frac{v_f + v_o}{2} $$.', 
            difficulty: 2 
        },
        { 
            type: 'calculation', 
            question: 'Un objeto con $$a = 4 \\, m/s^2$$ parte de $$x_o=5\\,m$$ con $$v_o=2\\,m/s$$. ¿Cuál es su posición final a los 3 segundos?', 
            formula: '$$x_f = x_o + v_o t + \\frac{at^2}{2}$$',
            given: { x_o: 5, v_o: 2, a: 4, t: 3 }, 
            options: ['29 m', '23 m', '35 m', '18 m'], 
            correct: 0, 
            explanation: 'Sustituyendo en la ecuación completa: $$x_f = 5 + 2(3) + \\frac{4(3^2)}{2} = 5 + 6 + 18 = 29 \\, m$$.', 
            difficulty: 3
        },
        { 
            type: 'theory', 
            question: 'Si un objeto tiene velocidad y aceleración en el mismo sentido (ambas positivas o ambas negativas), el objeto:', 
            options: ['Está frenando', 'Está aumentando su rapidez', 'Se mueve a velocidad constante', 'Está en una trayectoria curva'], 
            correct: 1, 
            explanation: 'Cuando los vectores velocidad y aceleración tienen el mismo sentido, el módulo de la velocidad (rapidez) aumenta. El objeto se mueve cada vez más rápido.', 
            difficulty: 2 
        }
    ],


mcu: [
        { 
            type: 'theory', 
            question: 'En un Movimiento Circular Uniforme (MCU), ¿qué magnitud permanece constante?', 
            options: ['El vector velocidad lineal', 'El vector aceleración centrípeta', 'La rapidez (módulo de la velocidad lineal)', 'El vector posición'], 
            correct: 2, 
            explanation: 'En un MCU, la rapidez (el módulo del vector velocidad) es constante, pero la dirección del vector velocidad cambia continuamente, por lo que el vector velocidad no es constante.', 
            difficulty: 2 
        },
        { 
            type: 'theory', 
            question: 'La aceleración en un MCU se llama "centrípeta" porque...', 
            options: ['Siempre apunta hacia afuera del círculo', 'Es tangente a la trayectoria', 'Siempre apunta hacia el centro del círculo', 'Es siempre cero'], 
            correct: 2, 
            explanation: 'La aceleración centrípeta es la responsable de cambiar la dirección del vector velocidad para mantener la trayectoria circular, y para lograrlo, debe apuntar constantemente hacia el centro de la circunferencia.', 
            difficulty: 2 
        },
        { 
            type: 'calculation', 
            question: 'Un objeto en una trayectoria circular de 2 m de radio se mueve a una rapidez constante de 10 m/s. ¿Cuál es su aceleración centrípeta?', 
            formula: '$$ a_c = \\frac{v^2}{r} $$',
            given: { v: 10, r: 2 }, 
            options: ['20 m/s²', '5 m/s²', '50 m/s²', '100 m/s²'], 
            correct: 2, 
            explanation: 'La aceleración centrípeta se calcula como $$ a_c = \\frac{v^2}{r} = \\frac{(10 \\, m/s)^2}{2 \\, m} = \\frac{100}{2} = 50 \\, m/s^2 $$.', 
            difficulty: 2 
        },
        { 
            type: 'theory', 
            question: '¿Cuál es la relación matemática correcta entre el período (T) y la frecuencia (f)?', 
            options: ['$$ T = f $$', '$$ T = 1/f $$', '$$ T = 2\\pi f $$', '$$ T = f^2 $$'], 
            correct: 1, 
            explanation: 'El período (T) es el tiempo de una vuelta completa, mientras que la frecuencia (f) es el número de vueltas por segundo. Son inversamente proporcionales: $$ T = 1/f $$ y $$ f = 1/T $$.', 
            difficulty: 1 
        },
        { 
            type: 'calculation', 
            question: 'Un CD gira a 300 revoluciones por minuto (RPM). ¿Cuál es su frecuencia en Hertz (Hz)?', 
            formula: '$$ f(Hz) = \\frac{rpm}{60} $$',
            given: { rpm: 300 }, 
            options: ['50 Hz', '5 Hz', '18000 Hz', '60 Hz'], 
            correct: 1, 
            explanation: 'Revoluciones por minuto (RPM) significa vueltas/minuto. Para pasar a vueltas/segundo (Hz), dividimos por 60. $$ f = \\frac{300}{60} = 5 \\, Hz $$.', 
            difficulty: 2 
        },
        { 
            type: 'calculation', 
            question: 'Una rueda de 0.5 m de radio gira con una velocidad angular ($$\\omega$$) de 4 rad/s. ¿Cuál es la velocidad lineal (tangencial) de un punto en su borde?', 
            formula: '$$ v = \\omega \\cdot r $$',
            given: { omega: 4, r: 0.5 }, 
            options: ['1 m/s', '2 m/s', '4 m/s', '8 m/s'], 
            correct: 1, 
            explanation: 'La velocidad lineal (o tangencial) se relaciona con la angular mediante $$ v = \\omega \\cdot r = 4 \\, rad/s \\cdot 0.5 \\, m = 2 \\, m/s $$.', 
            difficulty: 2 
        },
        { 
            type: 'calculation', 
            question: 'Un atleta corre por una pista circular y tarda 80 segundos en dar una vuelta completa. ¿Cuál es su velocidad angular ($$\\omega$$)?', 
            formula: '$$ \\omega = \\frac{2\\pi}{T} $$',
            given: { T: 80 }, 
            options: ['$$\\pi/20$$ rad/s', '$$\\pi/40$$ rad/s', '$$\\pi/80$$ rad/s', '$$80\\pi$$ rad/s'], 
            correct: 1, 
            explanation: 'El período T es 80 s. La velocidad angular es $$ \\omega = \\frac{2\\pi}{T} = \\frac{2\\pi}{80} = \\frac{\\pi}{40} \\, rad/s $$.', 
            difficulty: 2 
        },
        { 
            type: 'theory', 
            question: 'Si un objeto en MCU duplica su rapidez (manteniendo el radio constante), su aceleración centrípeta...', 
            options: ['Se duplica', 'Se reduce a la mitad', 'Se cuadruplica', 'No cambia'], 
            correct: 2, 
            explanation: 'La aceleración centrípeta es $$ a_c = v^2/r $$. Si la velocidad $$v$$ se duplica a $$2v$$, la nueva aceleración será $$ a_c = \\frac{(2v)^2}{r} = \\frac{4v^2}{r} $$, es decir, se cuadruplica.', 
            difficulty: 3 
        },
        { 
            type: 'calculation', 
            question: 'Calcula el período del segundero de un reloj analógico.', 
            options: ['1 s', '12 s', '60 s', '3600 s'], 
            correct: 2, 
            explanation: 'El período es el tiempo que tarda en dar una vuelta completa. El segundero de un reloj tarda 60 segundos en completar una revolución, por lo tanto $$ T = 60s $$.', 
            difficulty: 1 
        },
        { 
            type: 'theory', 
            question: 'En un MCU, ¿existe aceleración tangencial?', 
            options: ['Sí, es constante y positiva', 'Sí, es variable', 'No, es siempre cero', 'Solo al principio del movimiento'], 
            correct: 2, 
            explanation: 'La aceleración tangencial es la responsable de cambiar el módulo de la velocidad (la rapidez). Como en un MCU la rapidez es constante por definición, la aceleración tangencial es nula.', 
            difficulty: 2 
        },
        { 
            type: 'calculation', 
            question: 'Un coche toma una curva de 25 m de radio a 54 km/h. ¿Cuál es su aceleración centrípeta?', 
            formula: '$$ a_c = v^2/r $$',
            given: { r: 25, v_kmh: 54 }, 
            options: ['2.16 m/s²', '116.6 m/s²', '9 m/s²', '15 m/s²'], 
            correct: 2, 
            explanation: 'Primero, convierte la velocidad a m/s: $$ 54 \\, km/h = 15 \\, m/s $$. Luego, calcula la aceleración: $$ a_c = \\frac{(15 \\, m/s)^2}{25 \\, m} = \\frac{225}{25} = 9 \\, m/s^2 $$.', 
            difficulty: 3 
        },
        { 
            type: 'theory', 
            question: '¿Cuál es la unidad de la velocidad angular ($$\\omega$$) en el SI?', 
            options: ['Grados por segundo', 'Revoluciones por minuto', 'Hertz', 'Radianes por segundo'], 
            correct: 3, 
            explanation: 'Aunque se usan otras unidades, la unidad fundamental de la velocidad angular en el SI es el radián por segundo (rad/s).', 
            difficulty: 1 
        },
        { 
            type: 'calculation', 
            question: 'Un punto en un disco que gira a 5 rad/s está a 10 cm del centro. ¿Cuál es su velocidad lineal?', 
            formula: '$$ v = \\omega \\cdot r $$',
            given: { omega: 5, r_cm: 10 }, 
            options: ['50 m/s', '5 m/s', '0.5 m/s', '2 m/s'], 
            correct: 2, 
            explanation: 'Primero, convierte el radio a metros: $$ 10 \\, cm = 0.1 \\, m $$. Luego, calcula la velocidad: $$ v = 5 \\, rad/s \\cdot 0.1 \\, m = 0.5 \\, m/s $$.', 
            difficulty: 2 
        },
        { 
            type: 'theory', 
            question: 'Si un objeto completa 10 vueltas en 2 segundos, ¿cuál es su frecuencia?', 
            options: ['20 Hz', '0.2 Hz', '5 Hz', '10 Hz'], 
            correct: 2, 
            explanation: 'La frecuencia (f) es el número de vueltas (n) dividido por el tiempo (t). $$ f = n/t = 10 / 2 = 5 \\, Hz $$.', 
            difficulty: 1 
        },
        { 
            type: 'calculation', 
            question: 'Un ventilador gira con $$ \\omega = 20\\pi $$ rad/s. ¿Cuál es su período T?', 
            formula: '$$ T = \\frac{2\\pi}{\\omega} $$',
            given: { omega: '20\\pi' }, 
            options: ['0.1 s', '10 s', '0.2 s', '20 s'], 
            correct: 0, 
            explanation: 'El período se relaciona con la velocidad angular mediante $$ T = \\frac{2\\pi}{\\omega} $$. Sustituyendo, $$ T = \\frac{2\\pi}{20\\pi} = \\frac{1}{10} = 0.1 \\, s $$.', 
            difficulty: 2 
        }
    ],


gravedad: [
        { 
            type: 'theory', 
            question: 'En ausencia de aire, si se dejan caer una pluma y una bola de bolos desde la misma altura, ¿cuál llega primero al suelo?', 
            options: ['La bola de bolos', 'La pluma', 'Llegan al mismo tiempo', 'Depende de la altura'], 
            correct: 2, 
            explanation: 'En el vacío, todos los objetos caen con la misma aceleración (g), independientemente de su masa o forma. Por lo tanto, llegan al suelo simultáneamente.', 
            difficulty: 2 
        },
        { 
            type: 'calculation', 
            question: 'Se deja caer una manzana desde el reposo. ¿Qué velocidad tendrá después de 3 segundos? (Usa $$ g = 10 \\, m/s^2 $$)', 
            formula: '$$v_f = v_o + gt$$',
            given: { v_o: 0, g: 10, t: 3 }, 
            options: ['10 m/s', '3.33 m/s', '30 m/s', '13 m/s'], 
            correct: 2, 
            explanation: 'En caída libre desde el reposo, $$v_o=0$$. La velocidad final es $$ v_f = 0 + (10 \\, m/s^2 \\cdot 3 \\, s) = 30 \\, m/s $$.', 
            difficulty: 1 
        },
        { 
            type: 'theory', 
            question: 'Cuando un objeto lanzado hacia arriba alcanza su altura máxima, ¿cuál es el valor de su velocidad instantánea?', 
            options: ['Es máxima', 'Es igual a g', 'Es cero', 'Depende de la masa'], 
            correct: 2, 
            explanation: 'En el punto más alto de la trayectoria, el objeto deja de subir y está a punto de empezar a bajar. En ese preciso instante, su velocidad vertical es cero.', 
            difficulty: 1 
        },
        { 
            type: 'theory', 
            question: 'En el punto más alto de un lanzamiento vertical, la aceleración del objeto es:', 
            options: ['Cero', 'Máxima y hacia arriba', 'Igual a g, hacia abajo', 'Igual a g, hacia arriba'], 
            correct: 2, 
            explanation: 'Aunque la velocidad es momentáneamente cero en el punto más alto, la fuerza de la gravedad sigue actuando sobre el objeto. Por lo tanto, su aceleración sigue siendo g, apuntando siempre hacia abajo.', 
            difficulty: 3 
        },
        { 
            type: 'calculation', 
            question: '¿Desde qué altura se debe dejar caer un objeto para que golpee el suelo en 4 segundos? (Usa $$ g = 10 \\, m/s^2 $$)', 
            formula: '$$ h = v_o t + \\frac{1}{2} g t^2 $$',
            given: { v_o: 0, t: 4, g: 10 }, 
            options: ['40 m', '160 m', '80 m', '20 m'], 
            correct: 2, 
            explanation: 'Partiendo del reposo ($$v_o=0$$), la altura es $$ h = \\frac{1}{2} g t^2 = \\frac{1}{2} (10 \\, m/s^2) (4 \\, s)^2 = 5 \\cdot 16 = 80 \\, m $$.', 
            difficulty: 2 
        },
        { 
            type: 'calculation', 
            question: 'Se lanza una piedra hacia arriba con una velocidad inicial de 30 m/s. ¿Cuánto tiempo tarda en alcanzar su altura máxima? (Usa $$ g = 10 \\, m/s^2 $$)', 
            formula: '$$ v_f = v_o - g t $$',
            given: { v_o: 30, v_f: 0, g: 10 }, 
            options: ['1 s', '3 s', '10 s', '30 s'], 
            correct: 1, 
            explanation: 'En la altura máxima, la velocidad final es $$ v_f = 0 $$. Usando la fórmula (con g negativa porque se opone al movimiento): $$ 0 = 30 - 10t \\Rightarrow 10t = 30 \\Rightarrow t = 3 \\, s $$.', 
            difficulty: 2 
        },
        { 
            type: 'calculation', 
            question: '¿Qué altura máxima alcanza la piedra del problema anterior? ($$v_o=30$$ m/s, $$g=10 \\, m/s^2$$)', 
            formula: '$$ v_f^2 = v_o^2 - 2gh $$',
            given: { v_o: 30, v_f: 0, g: 10 }, 
            options: ['30 m', '90 m', '45 m', '60 m'], 
            correct: 2, 
            explanation: 'En la altura máxima, $$v_f=0$$. Despejamos h: $$ h = \\frac{v_o^2 - v_f^2}{2g} = \\frac{30^2 - 0^2}{2 \\cdot 10} = \\frac{900}{20} = 45 \\, m $$.', 
            difficulty: 3 
        },
        { 
            type: 'theory', 
            question: 'Si lanzas un objeto hacia arriba, el tiempo que tarda en subir hasta la altura máxima es...', 
            options: ['Mayor que el tiempo de bajada', 'Menor que el tiempo de bajada', 'Igual al tiempo que tarda en bajar al mismo nivel', 'La mitad del tiempo total de vuelo'], 
            correct: 2, 
            explanation: 'Despreciando la resistencia del aire, la trayectoria de un lanzamiento vertical es simétrica. El objeto tarda el mismo tiempo en subir que en bajar hasta el mismo punto de partida.', 
            difficulty: 2 
        },
        { 
            type: 'calculation', 
            question: 'Se deja caer un objeto desde una altura de 125 m. ¿Con qué velocidad llega al suelo? (Usa $$ g = 10 \\, m/s^2 $$)', 
            formula: '$$ v_f^2 = v_o^2 + 2gh $$',
            given: { h: 125, g: 10, v_o: 0 }, 
            options: ['25 m/s', '50 m/s', '12.5 m/s', '10 m/s'], 
            correct: 1, 
            explanation: 'Usando la ecuación para caída libre ($$v_o=0$$): $$ v_f^2 = 2gh \\Rightarrow v_f = \\sqrt{2gh} = \\sqrt{2 \\cdot 10 \\cdot 125} = \\sqrt{2500} = 50 \\, m/s $$.', 
            difficulty: 2 
        },
        { 
            type: 'theory', 
            question: 'En un lanzamiento vertical hacia arriba, la velocidad y la aceleración tienen:', 
            options: ['El mismo sentido siempre', 'Sentidos opuestos en la subida y el mismo en la bajada', 'El mismo sentido en la subida y opuestos en la bajada', 'Sentidos opuestos siempre'], 
            correct: 1, 
            explanation: 'Durante la subida, la velocidad es hacia arriba (+) y la aceleración de la gravedad hacia abajo (-). Durante la bajada, tanto la velocidad como la gravedad apuntan hacia abajo (- y -).', 
            difficulty: 2 
        },
        { 
            type: 'calculation', 
            question: 'Se lanza una pelota hacia abajo desde un puente con $$v_o=5$$ m/s. ¿Qué velocidad tiene tras 2 segundos? (Usa $$g=10 \\, m/s^2$$)', 
            formula: '$$v_f = v_o + gt$$',
            given: { v_o: 5, t: 2, g: 10 }, 
            options: ['15 m/s', '20 m/s', '25 m/s', '10 m/s'], 
            correct: 2, 
            explanation: 'Como la velocidad inicial y la gravedad tienen el mismo sentido (hacia abajo), se suman: $$v_f = 5 + 10 \\cdot 2 = 5 + 20 = 25 \\, m/s$$.', 
            difficulty: 2 
        },
        { 
            type: 'theory', 
            question: 'El movimiento de caída libre es un caso particular de:', 
            options: ['MRU', 'MCU', 'MRUA', 'Movimiento Armónico Simple'], 
            correct: 2, 
            explanation: 'La caída libre (despreciando el rozamiento con el aire) es un Movimiento Rectilíneo Uniformemente Acelerado (MRUA) donde la aceleración constante es la de la gravedad, g.', 
            difficulty: 1 
        },
        { 
            type: 'calculation', 
            question: 'Un objeto lanzado hacia arriba tarda 6 segundos en total para volver al punto de partida. ¿Con qué velocidad inicial se lanzó? (Usa $$g=10 \\, m/s^2$$)', 
            options: ['60 m/s', '10 m/s', '30 m/s', '120 m/s'], 
            correct: 2, 
            explanation: 'El tiempo total de vuelo es 6s, por lo que el tiempo de subida es la mitad: 3s. En la altura máxima, $$v_f=0$$. Usando $$v_f = v_o - gt_{subida}$$, tenemos $$0 = v_o - 10 \\cdot 3$$, de donde $$v_o = 30 \\, m/s$$.', 
            difficulty: 3 
        },
        { 
            type: 'theory', 
            question: 'Si la resistencia del aire es considerable, ¿qué objeto cae más rápido desde la misma altura?', 
            options: ['Una hoja de papel extendida', 'Una bola de papel compacta', 'Caen igual', 'Depende del peso'], 
            correct: 1, 
            explanation: 'La resistencia del aire depende de la forma y la velocidad. La hoja extendida ofrece más superficie a la fricción del aire, por lo que cae más lentamente que la bola de papel, que es más aerodinámica.', 
            difficulty: 1 
        },
        { 
            type: 'calculation', 
            question: 'Un astronauta en la Luna ($$g \\approx 1.6 \\, m/s^2$$) deja caer un martillo desde 2 m de altura. ¿Cuánto tarda en caer?', 
            formula: '$$t = \\sqrt{2h/g}$$',
            given: { h: 2, g: 1.6 }, 
            options: ['1.12 s', '2.5 s', '1.58 s', '0.8 s'], 
            correct: 1, 
            explanation: 'Despejamos t de la fórmula de altura $$h = \\frac{1}{2}gt^2$$. Obtenemos $$ t = \\sqrt{\\frac{2h}{g}} = \\sqrt{\\frac{2 \\cdot 2}{1.6}} = \\sqrt{2.5} \\approx 1.58 \\, s $$.', 
            difficulty: 3 
        }
    ],


parabolico: [
        { 
            type: 'theory', 
            question: 'El movimiento parabólico es una composición de dos movimientos. Estos son:', 
            options: ['Dos MRU', 'Dos MRUA', 'Un MRU en el eje horizontal y un MRUA en el vertical', 'Un MRUA en el eje horizontal y un MRU en el vertical'], 
            correct: 2, 
            explanation: 'El movimiento parabólico se analiza como la superposición de dos movimientos independientes: un Movimiento Rectilíneo Uniforme (MRU) en el eje horizontal (ya que no hay aceleración horizontal) y un Movimiento Rectilíneo Uniformemente Acelerado (MRUA) en el eje vertical (debido a la aceleración de la gravedad).', 
            difficulty: 2 
        },
        { 
            type: 'theory', 
            question: 'En un tiro parabólico (sin fricción), ¿qué componente de la velocidad permanece constante?', 
            options: ['La componente vertical de la velocidad', 'La componente horizontal de la velocidad', 'Ambas componentes cambian', 'El módulo de la velocidad total'], 
            correct: 1, 
            explanation: 'Como no hay fuerzas horizontales (despreciando el aire), la aceleración horizontal es cero. Por lo tanto, la componente horizontal de la velocidad ($$v_x$$) permanece constante durante todo el movimiento.', 
            difficulty: 2 
        },
        { 
            type: 'theory', 
            question: 'En un tiro parabólico, ¿en qué punto de la trayectoria la velocidad vertical es cero?', 
            options: ['En el punto de lanzamiento', 'Justo antes de tocar el suelo', 'En la altura máxima', 'Nunca es cero'], 
            correct: 2, 
            explanation: 'El proyectil sube hasta que su velocidad vertical se anula por efecto de la gravedad. En ese instante ($$v_y=0$$), ha alcanzado la altura máxima de su trayectoria y comienza a descender.', 
            difficulty: 2 
        },
        { 
            type: 'calculation', 
            question: 'Un cañón dispara un proyectil con una velocidad inicial de 100 m/s y un ángulo de 30°. ¿Cuál es la componente horizontal de la velocidad inicial? ($$\\cos(30°) \\approx 0.866$$)', 
            formula: '$$ v_{ix} = v_i \\cos(\\theta) $$',
            given: { v_i: 100, theta: 30 }, 
            options: ['50 m/s', '100 m/s', '86.6 m/s', '30 m/s'], 
            correct: 2, 
            explanation: 'La componente horizontal de la velocidad es $$ v_{ix} = v_i \\cos(\\theta) = 100 \\, m/s \\cdot \\cos(30°) \\approx 100 \\cdot 0.866 = 86.6 \\, m/s $$.', 
            difficulty: 2 
        },
        { 
            type: 'calculation', 
            question: 'Para el proyectil anterior ($$v_i=100$$ m/s, $$ \\theta=30° $$), ¿cuál es la componente vertical de la velocidad inicial? ($$\\sin(30°)=0.5$$)', 
            formula: '$$ v_{iy} = v_i \\sin(\\theta) $$',
            given: { v_i: 100, theta: 30 }, 
            options: ['50 m/s', '100 m/s', '86.6 m/s', '30 m/s'], 
            correct: 0, 
            explanation: 'La componente vertical de la velocidad inicial es $$ v_{iy} = v_i \\sin(\\theta) = 100 \\, m/s \\cdot \\sin(30°) = 100 \\cdot 0.5 = 50 \\, m/s $$.', 
            difficulty: 2 
        },
        { 
            type: 'theory', 
            question: 'Despreciando la fricción del aire, ¿bajo qué ángulo de lanzamiento se consigue el máximo alcance horizontal?', 
            options: ['30°', '45°', '60°', '90° (vertical)'], 
            correct: 1, 
            explanation: 'El alcance máximo se logra con un ángulo de lanzamiento de 45°. La fórmula del alcance es $$ R = \\frac{v_i^2 \\sin(2\\theta)}{g} $$, y $$ \\sin(2\\theta) $$ es máximo (igual a 1) cuando $$ 2\\theta = 90° $$, es decir, $$ \\theta = 45° $$.', 
            difficulty: 3 
        },
        { 
            type: 'calculation', 
            question: 'Se patea un balón con $$v_i=20$$ m/s y un ángulo de 37° ($$\\sin(37°)\\approx0.6$$). ¿Qué altura máxima alcanza? (Usa $$g=10 \\, m/s^2$$)', 
            formula: '$$ h_{max} = \\frac{(v_i \\sin\\theta)^2}{2g} $$',
            given: { v_i: 20, theta: 37, g: 10 }, 
            options: ['12 m', '7.2 m', '20 m', '18 m'], 
            correct: 1, 
            explanation: 'Primero, la velocidad vertical inicial es $$ v_{iy} = 20 \\cdot \\sin(37°) \\approx 20 \\cdot 0.6 = 12 \\, m/s $$. La altura máxima es $$ h_{max} = \\frac{v_{iy}^2}{2g} = \\frac{12^2}{2 \\cdot 10} = \\frac{144}{20} = 7.2 \\, m $$.', 
            difficulty: 3 
        },
        { 
            type: 'calculation', 
            question: 'Se lanza una piedra horizontalmente desde un acantilado de 45 m de altura. ¿Cuánto tiempo tarda en llegar al agua? (Usa g=10 m/s²)', 
            formula: '$$ t = \\sqrt{\\frac{2h}{g}} $$',
            given: { h: 45, g: 10 }, 
            options: ['4.5 s', '9 s', '2.12 s', '3 s'], 
            correct: 3, 
            explanation: 'El tiempo de caída en un lanzamiento horizontal solo depende de la altura y la gravedad. $$ t = \\sqrt{\\frac{2h}{g}} = \\sqrt{\\frac{2 \\cdot 45}{10}} = \\sqrt{9} = 3 \\, s $$.', 
            difficulty: 2 
        },
        { 
            type: 'calculation', 
            question: 'En el problema anterior, si la piedra se lanzó con $$v_x=10$$ m/s, ¿qué distancia horizontal (alcance) recorre?', 
            formula: '$$ x = v_x \\cdot t $$',
            given: { v_x: 10, t: 3 }, 
            options: ['10 m', '13 m', '30 m', '45 m'], 
            correct: 2, 
            explanation: 'El alcance horizontal es el producto de la velocidad horizontal (constante) y el tiempo de vuelo, que es 3s. $$ x = 10 \\, m/s \\cdot 3 \\, s = 30 \\, m $$.', 
            difficulty: 2 
        },
        { 
            type: 'theory', 
            question: 'Un bombardero vuela horizontalmente a velocidad constante y suelta una bomba. Sin considerar la fricción del aire, ¿dónde caerá la bomba?', 
            options: ['Detrás del avión', 'Delante del avión', 'Directamente debajo del avión', 'Depende de la altura del vuelo'], 
            correct: 2, 
            explanation: 'La bomba conserva la velocidad horizontal del avión en el momento de ser soltada. Como ambos tienen la misma velocidad horizontal y no hay aceleración en ese eje, ambos recorren la misma distancia horizontal en el mismo tiempo. La bomba caerá justo debajo de donde esté el avión.', 
            difficulty: 2 
        },
        { 
            type: 'calculation', 
            question: 'Un proyectil se lanza con $$v_i=50$$ m/s y un ángulo de 53° ($$\\sin 53° \\approx 0.8$$). ¿Cuál es su tiempo total de vuelo? (Usa g=10 m/s²)', 
            formula: '$$ t_{vuelo} = \\frac{2 v_i \\sin\\theta}{g} $$',
            given: { v_i: 50, theta: 53, g: 10 }, 
            options: ['4 s', '6 s', '8 s', '10 s'], 
            correct: 2, 
            explanation: 'La velocidad vertical inicial es $$v_{iy} = 50 \\cdot \\sin 53° \\approx 50 \\cdot 0.8 = 40 \\, m/s$$. El tiempo total de vuelo es el doble del tiempo de subida: $$t_{vuelo} = \\frac{2v_{iy}}{g} = \\frac{2 \\cdot 40}{10} = 8 \\, s$$.', 
            difficulty: 3 
        },
        { 
            type: 'calculation', 
            question: 'Con los datos del problema anterior ($$v_i=50$$ m/s, $$ \\theta=53° $$), ¿cuál es el alcance horizontal? ($$\\cos 53° \\approx 0.6, t_{vuelo}=8s$$)', 
            formula: '$$ R = v_{ix} \\cdot t_{vuelo} $$',
            given: { v_i: 50, theta: 53, t: 8 }, 
            options: ['240 m', '320 m', '400 m', '500 m'], 
            correct: 0, 
            explanation: 'La velocidad horizontal es $$v_{ix} = 50 \\cdot \\cos 53° \\approx 50 \\cdot 0.6 = 30 \\, m/s$$. El alcance es $$ R = v_{ix} \\cdot t_{vuelo} = 30 \\, m/s \\cdot 8 \\, s = 240 \\, m $$.', 
            difficulty: 3 
        },
        { 
            type: 'theory', 
            question: '¿Para qué par de ángulos de lanzamiento (con la misma rapidez inicial) se obtiene el mismo alcance horizontal?', 
            options: ['30° y 45°', '20° y 80°', '40° y 50°', '45° y 60°'], 
            correct: 2, 
            explanation: 'Se obtiene el mismo alcance para ángulos complementarios (que suman 90°), como 40° y 50°. Esto se debe a que la función $$ \\sin(2\\theta) $$ en la fórmula del alcance tiene el mismo valor para $$ \\theta $$ y $$ 90° - \\theta $$.', 
            difficulty: 3 
        },
        { 
            type: 'theory', 
            question: 'La velocidad de un proyectil en el punto de altura máxima de un tiro parabólico:', 
            options: ['Es cero', 'Es igual a la componente vertical de la velocidad inicial', 'Es igual a la componente horizontal de la velocidad inicial', 'Es máxima'], 
            correct: 2, 
            explanation: 'En el punto más alto, la componente vertical de la velocidad es momentáneamente cero, pero la componente horizontal ($$v_x$$) sigue siendo la misma que al principio. Por tanto, la velocidad total no es nula, sino igual a $$v_x$$.', 
            difficulty: 3 
        },
        { 
            type: 'calculation', 
            question: 'Desde el suelo se lanza una pelota que debe caer a 80 m de distancia. El tiempo de vuelo es de 4 s. ¿Cuál fue la componente horizontal de su velocidad inicial?', 
            formula: '$$ v_x = R / t $$',
            given: { R: 80, t: 4 }, 
            options: ['10 m/s', '20 m/s', '40 m/s', '320 m/s'], 
            correct: 1, 
            explanation: 'El movimiento horizontal es un MRU. La velocidad horizontal, que es constante, es igual al alcance dividido por el tiempo de vuelo: $$ v_x = \\frac{80 \\, m}{4 \\, s} = 20 \\, m/s $$.', 
            difficulty: 2 
        }
    ]

        };

// I N D I C A C I Ó N: Función principal que se ejecuta al cargar la página por completo.
        // C O M E N T A R I O: Orquesta toda la configuración inicial del juego.
        function initializeGame() {
            elements.ctx = elements.canvas.getContext('2d');
            audioSystem = new AudioSystem(); // Se crea la instancia del sistema de audio.
            resizeCanvas();
            resetGameState();
            setupEventListeners();
            initializeStars();
            initializeCosmicObjects();
            updateUI();
            gameLoop(); // Inicia el bucle principal de animación.
        }

        // I N D I C A C I Ó N: Ajusta el tamaño del canvas para que ocupe el espacio disponible en la ventana.
        function resizeCanvas() {
            const wrapper = document.querySelector('.game-wrapper');
            const statsHeight = document.querySelector('.stats-bar').offsetHeight;
            const controlsHeight = document.querySelector('.controls-container').offsetHeight;
            const footerHeight = document.querySelector('.galactic-footer').offsetHeight;
            
            // C O M E N T A R I O: El alto del canvas es el alto de la ventana menos los paneles superior e inferior.
            elements.canvas.width = window.innerWidth;
            elements.canvas.height = window.innerHeight - statsHeight - controlsHeight - footerHeight;
            
            // C O M E N T A R I O: Reposiciona la nave si el estado del juego ya existe, para evitar que quede fuera de la pantalla.
            if (gameState && gameState.spaceship) {
                gameState.spaceship.x = elements.canvas.width / 4;
                gameState.spaceship.y = elements.canvas.height / 2;
                gameState.spaceship.targetX = gameState.spaceship.x;
                gameState.spaceship.targetY = gameState.spaceship.y;
            }
        }

        // I N D I C A C I Ó N: Restablece todas las variables del juego a su estado inicial.
        // C O M E N T A R I O: Esencial para empezar una nueva partida o al presionar el botón de reiniciar.
        function resetGameState() {
            const levelValue = parseInt(elements.levelSelect.value);
            const selectedTopics = Array.from(elements.topicCheckboxes).filter(cb => cb.checked).map(cb => cb.value);
            
            // C O M E N T A R I O: Asegura que al menos un tema esté seleccionado por defecto.
            if (selectedTopics.length === 0) {
                selectedTopics.push('magnitudes'); // Tema por defecto
                document.getElementById('topicMagnitudes').checked = true;
            }

            gameState = {
                isGameActive: false,
                isPaused: false,
                currentLevel: levelValue,
                selectedTopics: selectedTopics,
                lives: CONFIG.INITIAL_LIVES,
                score: 0,
                questionsAnswered: 0,
                correctAnswers: 0,
                currentLevelProgress: 0,
                currentQuestion: null,
                selectedAnswer: null,
                levelQuestionPool: [],
                particles: [],
                stars: [],
                spaceship: {
                    x: elements.canvas.width / 4,
                    y: elements.canvas.height / 2,
                    targetX: elements.canvas.width / 4,
                    targetY: elements.canvas.height / 2,
                    trail: [],
                    angle: 0
                },
                cosmicObjects: { meteorites: [], planets: [], comets: [] },
                animationId: gameState.animationId || null
            };
        }

// C O M E N T A R I O: Funciones para crear los elementos visuales del fondo y los objetos interactivos.
        
        // I N D I C A C I Ó N: Mejora del sistema estelar para un fondo más dinámico y colorido.
        function initializeStars() {
            gameState.stars = [];
            for (let i = 0; i < CONFIG.MAX_STARS; i++) {
                gameState.stars.push({
                    x: Math.random() * elements.canvas.width,
                    y: Math.random() * elements.canvas.height,
                    speed: 0.1 + Math.random() * 0.5,
                    radius: Math.random() * 1.5,
                    // D E C O R A C I Ó N: Se usa HSL para dar a las estrellas colores sutiles (blanco, azul pálido, amarillo pálido).
                    color: `hsl(${200 + Math.random() * 60}, 100%, ${85 + Math.random() * 15}%)`,
                    alpha: 0.3 + Math.random() * 0.7,
                    twinkleSpeed: Math.random() * 0.02,
                });
            }
        }

        // I N D I C A C I Ó N: Crea todos los objetos cósmicos (planetas, meteoritos, cometas) al inicio.
        function initializeCosmicObjects() {
            const config = CONFIG.COSMIC_OBJECTS;
            gameState.cosmicObjects = { meteorites: [], planets: [], comets: [] };
            
            // C O M E N T A R I O: Genera la cantidad de meteoritos y cometas definida en la configuración adaptable.
            for (let i = 0; i < config.meteorites.count; i++) gameState.cosmicObjects.meteorites.push(createCosmicObject('meteorite'));
            for (let i = 0; i < config.comets.count; i++) gameState.cosmicObjects.comets.push(createCosmicObject('comet'));

            const planetEmojis = ['🪐', '🌍', '🌕', '🔴', '🟠', '🟡', '🟢', '🔵', '🟣'];
            const minDistance = 150; // Distancia mínima para evitar que los planetas se superpongan.

            for (let i = 0; i < config.planets.count; i++) {
                let newPlanet, validPosition, attempts = 0;
                // C O M E N T A R I O: Bucle para encontrar una posición válida para cada nuevo planeta.
                do {
                    validPosition = true;
                    newPlanet = {
                        type: 'planet',
                        x: (elements.canvas.width * 0.1) + (Math.random() * elements.canvas.width * 0.8),
                        y: (elements.canvas.height * 0.1) + (Math.random() * elements.canvas.height * 0.8),
                        speed: 0, // Los planetas son estáticos.
                        size: config.planets.size + Math.random() * 10,
                        angle: Math.random() * Math.PI * 2,
                        rotationSpeed: (Math.random() - 0.5) * 0.005, // Rotación muy lenta.
                        hasCollided: false,
                        trail: null,
                        emoji: planetEmojis[i % planetEmojis.length],
                        pulsePhase: Math.random() * Math.PI * 2 // Para la animación de pulso.
                    };

                    // I N D I C A C I Ó N: Comprueba la distancia con los planetas ya existentes.
                    for (const existingPlanet of gameState.cosmicObjects.planets) {
                        const dx = newPlanet.x - existingPlanet.x;
                        const dy = newPlanet.y - existingPlanet.y;
                        const distance = Math.sqrt(dx * dx + dy * dy);
                        if (distance < minDistance) {
                            validPosition = false;
                            break;
                        }
                    }
                    attempts++;
                } while (!validPosition && attempts < 100); // Se limita el número de intentos para evitar bucles infinitos.

                gameState.cosmicObjects.planets.push(newPlanet);
            }
        }
        
        // I N D I C A C I Ó N: Función auxiliar para crear un único objeto cósmico móvil (meteorito o cometa).
        function createCosmicObject(type) {
            const config = CONFIG.COSMIC_OBJECTS[type + 's'];
            const emoji = type === 'meteorite' ? '🪨' : '☄️';
            return {
                type: type,
                x: elements.canvas.width + Math.random() * 500, // Empieza fuera de la pantalla, a la derecha.
                y: Math.random() * elements.canvas.height,
                speed: config.speed + Math.random() * 0.5,
                size: config.size + Math.random() * 5,
                angle: Math.random() * Math.PI * 2,
                rotationSpeed: (Math.random() - 0.5) * 0.05,
                hasCollided: false,
                emoji: emoji
            };
        }


// I N D I C A C I Ó N: Configura todos los event listeners para los botones y controles del juego.
        // C O M E N T A R I O: Centraliza toda la interactividad del usuario en una sola función.
        function setupEventListeners() {
            elements.startButton.addEventListener('click', startGame);
            elements.pauseButton.addEventListener('click', togglePause);
            elements.helpButton.addEventListener('click', showHelpModal);
            elements.resetButton.addEventListener('click', resetGame);
            
            document.getElementById('soundButton').addEventListener('click', () => {
                if (audioSystem) {
                    const enabled = audioSystem.toggle();
                    document.getElementById('soundButton').querySelector('.btn-icon').innerHTML = enabled ? '🔊' : '🔇';
                }
            });

            elements.levelSelect.addEventListener('change', () => {
                if (!gameState.isGameActive) {
                    gameState.currentLevel = parseInt(elements.levelSelect.value);
                    updateUI();
                }
            });

            elements.topicCheckboxes.forEach(cb => cb.addEventListener('change', () => {
                if (!gameState.isGameActive) {
                    updateSelectedTopics();
                    updateTopicDisplay();
                }
            }));

            // C O M E N T A R I O: Listeners para los botones dentro de las modales.
            elements.answerButton.addEventListener('click', submitAnswer);
            elements.nextButton.addEventListener('click', continueAfterFeedback);
            document.getElementById('closeHelp').addEventListener('click', closeModal);
            document.getElementById('nextLevelButton').addEventListener('click', advanceLevel);
            document.getElementById('resumeButton').addEventListener('click', resumeGame);
            document.getElementById('restartFromPause').addEventListener('click', resetGame);
            elements.restartGameButton.addEventListener('click', resetGame);

            // C O M E N T A R I O: Listeners para controlar la nave con el mouse y el dedo.
            elements.canvas.addEventListener('mousemove', e => {
                const rect = elements.canvas.getBoundingClientRect();
                gameState.spaceship.targetX = e.clientX - rect.left;
                gameState.spaceship.targetY = e.clientY - rect.top;
            });
            elements.canvas.addEventListener('touchmove', e => {
                e.preventDefault(); // Evita que la página se desplace en móviles.
                const rect = elements.canvas.getBoundingClientRect();
                const touch = e.touches[0];
                gameState.spaceship.targetX = touch.clientX - rect.left;
                gameState.spaceship.targetY = touch.clientY - rect.top;
            }, { passive: false });

            window.addEventListener('resize', () => {
                resizeCanvas();
                initializeStars();
                initializeCosmicObjects();
            });
        }

        // I N D I C A C I Ó N: Función para mezclar aleatoriamente un array (Algoritmo Fisher-Yates).
        // C O M E N T A R I O: Crucial para asegurar que las preguntas aparezcan en un orden aleatorio y no se repitan.
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        // I N D I C A C I Ó N: Lógica de control del juego (inicio, pausa, reinicio).
        function startGame() { 
            if (gameState.isGameActive) return;
            
            // I N D I C A C I Ó N: Inicializa el contexto de audio. Debe hacerse tras una interacción del usuario.
            if (audioSystem) audioSystem.init();

            gameState.isGameActive = true; 
            gameState.isPaused = false; 
            
            elements.startButton.disabled = true; 
            elements.pauseButton.disabled = false;
            elements.levelSelect.disabled = true;
            elements.topicCheckboxes.forEach(cb => cb.disabled = true);

            // C O M E N T A R I O: Crea el pozo de preguntas para el nivel actual, barajándolas.
            const pool = gameState.selectedTopics.flatMap(t => (questionDatabase[t] || []).map(q => ({ ...q, topic: t })));
            if (pool.length === 0) {
                alert("Error: No hay preguntas en los temas seleccionados. Seleccionando 'Magnitudes' por defecto.");
                resetGame();
                return;
            }
            shuffleArray(pool);
            gameState.levelQuestionPool = pool;
            
            setTimeout(showNextQuestion, 500); 
            updateUI(); 
        }
        
        function togglePause() { 
            if (!gameState.isGameActive) return; 
            gameState.isPaused = !gameState.isPaused; 
            elements.pauseModal.style.display = gameState.isPaused ? 'flex' : 'none'; 
        }

        function resumeGame() { 
            gameState.isPaused = false; 
            closeModal(); 
        }

        function resetGame() { 
            if (gameState.animationId) {
                cancelAnimationFrame(gameState.animationId); 
            }
            resetGameState(); 
            elements.startButton.disabled = false; 
            elements.pauseButton.disabled = true; 
            elements.levelSelect.disabled = false;
            elements.topicCheckboxes.forEach(cb => cb.disabled = false);
            closeModal(); 
            initializeStars(); 
            initializeCosmicObjects(); 
            updateUI(); 
            gameLoop(); 
        }

        function updateSelectedTopics() { 
            const selected = Array.from(elements.topicCheckboxes).filter(cb => cb.checked).map(cb => cb.value); 
            if (selected.length === 0) { 
                document.getElementById('topicMagnitudes').checked = true; 
                selected.push('magnitudes'); 
            } 
            gameState.selectedTopics = selected; 
        }

// I N D I C A C I Ó N: Lógica para seleccionar y mostrar la siguiente pregunta del desafío.
        function showNextQuestion() { 
            if (!gameState.isGameActive || gameState.isPaused) return; 

            const required = CONFIG.LEVELS[gameState.currentLevel].questions; 
            if (gameState.currentLevelProgress >= required) { 
                completeLevel(); // Si se completan las preguntas del nivel, finaliza el nivel.
                return; 
            } 
            
            // C O M E N T A R I O: Si el pozo de preguntas se agota, se rellena y se baraja de nuevo.
            if (gameState.levelQuestionPool.length === 0) {
                console.warn("¡Se acabaron las preguntas únicas! Reutilizando preguntas.");
                const pool = gameState.selectedTopics.flatMap(t => (questionDatabase[t] || []).map(q => ({ ...q, topic: t })));
                shuffleArray(pool);
                gameState.levelQuestionPool = pool;
            }

            gameState.currentQuestion = gameState.levelQuestionPool.pop();
            displayQuestion(); 
        }

        // I N D I C A C I Ó N: Muestra la pregunta actual y sus opciones en la ventana modal.
        function displayQuestion() { 
            const q = gameState.currentQuestion; 
            if (!q) return;

            // C O M E N T A R I O: Construye el HTML para los datos de la pregunta (tema, dificultad).
            elements.questionData.innerHTML = `<div class="flex justify-between items-center flex-wrap gap-2"><span><strong>Tema:</strong> ${getTopicDisplayName(q.topic)}</span><span><strong>Dificultad:</strong> ${'⭐'.repeat(q.difficulty || 1)}</span></div>`; 
            elements.questionText.innerHTML = q.question; 
            
            // C O M E N T A R I O: Añade fórmulas y datos si la pregunta los tiene.
            if (q.formula) elements.questionText.innerHTML += `<div class="math-expression mt-4 text-center text-cyan-300">${q.formula}</div>`; 
            if (q.given) { 
                let givenHTML = '<div class="math-expression mt-4"><strong>Datos:</strong> '; 
                for (const [key, value] of Object.entries(q.given)) {
                    givenHTML += `$$ ${key.replace('_', '_{')} = ${value} $$ `;
                }
                givenHTML += '</div>'; 
                elements.questionText.innerHTML += givenHTML; 
            } 

            displayOptions(); 
            elements.questionModal.style.display = 'flex'; 
            renderMath(elements.questionModal); // Llama a MathJax para renderizar las fórmulas.
        }

        function displayOptions() { 
            elements.optionsContainer.innerHTML = ''; 
            gameState.selectedAnswer = null; 
            elements.answerButton.disabled = true; 
            gameState.currentQuestion.options.forEach((opt, idx) => { 
                const btn = document.createElement('button'); 
                btn.className = 'option-button'; 
                btn.innerHTML = opt; 
                btn.onclick = () => selectOption(idx, btn); 
                elements.optionsContainer.appendChild(btn); 
            });
            renderMath(elements.optionsContainer); // Renderiza fórmulas en las opciones si las hubiera.
        }

        function selectOption(index, btnEl) { 
            document.querySelectorAll('.option-button').forEach(btn => btn.classList.remove('selected')); 
            btnEl.classList.add('selected'); 
            gameState.selectedAnswer = index; 
            elements.answerButton.disabled = false; 
        }
        
        // I N D I C A C I Ó N: Procesa la respuesta del usuario una vez que la confirma.
        function submitAnswer() { 
            if (gameState.selectedAnswer === null) return; 

            const isCorrect = gameState.selectedAnswer === gameState.currentQuestion.correct; 
            gameState.questionsAnswered++; 
            gameState.currentLevelProgress++; 

            if (isCorrect) { 
                gameState.correctAnswers++; 
                gameState.score += CONFIG.POINTS_PER_CORRECT; 
                if (audioSystem) audioSystem.play('success'); // Sonido de éxito.
                showFeedback('🎉 ¡Correcto!', '¡Excelente trabajo, cadete!', true); 
            } else { 
                gameState.lives--; 
                if (audioSystem) audioSystem.play('error'); // Sonido de error.
                showFeedback('❌ Incorrecto', 'Los errores son para aprender. ¡Revisa la solución!', false); 
                if (gameState.lives <= 0) { 
                    gameOver(); 
                    return; 
                } 
            } 
            elements.questionModal.style.display = 'none'; 
            updateUI(); 
        }

        // I N D I C A C I Ó N: Muestra la ventana modal de feedback con la explicación.
        function showFeedback(title, text, isCorrect) { 
            elements.feedbackTitle.textContent = title; 
            elements.feedbackText.textContent = text; 
            const q = gameState.currentQuestion; 
            
            // C O M E N T A R I O: Muestra la explicación solo si la pregunta tiene una.
            if (q.explanation) { 
                elements.solutionContainer.style.display = 'block'; 
                let html = `<h4>💡 Explicación:</h4><p>${q.explanation}</p>`; 
                elements.solutionContainer.innerHTML = html; 
            } else { 
                elements.solutionContainer.style.display = 'none'; 
            } 
            elements.feedbackModal.style.display = 'flex'; 
            elements.nextButton.onclick = continueAfterFeedback; 
            renderMath(elements.feedbackModal); // Renderiza cualquier fórmula en la explicación.
        }
        
        function continueAfterFeedback() { 
            closeModal(); 
            // C O M E N T A R I O: Pequeña pausa antes de mostrar la siguiente pregunta para que el jugador asimile el feedback.
            setTimeout(showNextQuestion, 500); 
        }


// I N D I C A C I Ó N: Lógica que se ejecuta al completar las preguntas de un nivel.
        function completeLevel() {
            const levelName = CONFIG.LEVELS[gameState.currentLevel].name;
            const accuracy = gameState.questionsAnswered > 0 ? (gameState.correctAnswers / gameState.questionsAnswered * 100).toFixed(1) : 0;
            const bonus = gameState.currentLevel * CONFIG.LEVEL_BONUS_MULTIPLIER;
            gameState.score += bonus;

            if (audioSystem) audioSystem.play('levelUp'); // Sonido de subir de nivel.

            // C O M E N T A R I O: Muestra la modal de nivel completado con estadísticas.
            document.getElementById('levelUpTitle').textContent = `🏆 Nivel ${gameState.currentLevel} Completado, Cadete 🧑‍🚀`;
            document.getElementById('levelUpText').innerHTML = `¡Felicidades, ${levelName}! Has demostrado tu valía.`;
            document.getElementById('levelUpStats').innerHTML = `
                <div class="grid grid-cols-2 gap-4 text-sm">
                    <div>Precisión: <span class="text-cyan-400">${accuracy}%</span></div>
                    <div>Bonus de Nivel: <span class="text-yellow-400">+${bonus}</span></div>
                    <div>Puntaje Total: <span class="text-purple-400">${gameState.score}</span></div>
                </div>`;
            
            elements.levelUpModal.style.display = 'flex';
            
            // C O M E N T A R I O: Cambia el botón si es el último nivel.
            if (gameState.currentLevel >= Object.keys(CONFIG.LEVELS).length) {
                document.getElementById('nextLevelButton').textContent = '🎊 ¡Misión Cumplida!';
                document.getElementById('nextLevelButton').onclick = completeGame;
            } else {
                document.getElementById('nextLevelButton').textContent = '🚀 ¡Siguiente Nivel!';
                document.getElementById('nextLevelButton').onclick = advanceLevel;
            }
        }

        // I N D I C A C I Ó N: Prepara el juego para el siguiente nivel.
        function advanceLevel() { 
            if (gameState.currentLevel < Object.keys(CONFIG.LEVELS).length) { 
                gameState.currentLevel++; 
                gameState.currentLevelProgress = 0; 
                elements.levelSelect.value = gameState.currentLevel; 
                updateUI(); 
                closeModal();
                setTimeout(showNextQuestion, 1000); 
            } else { 
                completeGame(); 
            } 
        }
        
        // I N D I C A C I Ó N: Muestra las estadísticas finales del juego.
        function showFinalStats(title) {
            closeModal();
            gameState.isGameActive = false;
            const accuracy = (gameState.correctAnswers / (gameState.questionsAnswered || 1) * 100).toFixed(1);
            const grade = calculateGrade().toFixed(1);
            elements.finalStatsTitle.innerHTML = `${title} 🧑‍🚀`;
            elements.finalStatsContent.innerHTML = `
                <div class="grid grid-cols-2 gap-x-4 gap-y-2 text-base">
                    <span class="font-bold text-cyan-300">Puntaje Final:</span>
                    <span class="text-right">${gameState.score}</span>
                    <span class="font-bold text-cyan-300">Precisión:</span>
                    <span class="text-right">${accuracy}%</span>
                    <span class="font-bold text-cyan-300">Vidas Restantes:</span>
                    <span class="text-right">${gameState.lives} / ${CONFIG.INITIAL_LIVES}</span>
                    <span class="font-bold text-cyan-300">Calificación Final:</span>
                    <span class="text-right font-bold text-yellow-400">${grade} / 5.0 ⭐</span>
                </div>
            `;
            elements.finalStatsModal.style.display = 'flex';
        }

        // C O M E N T A R I O: Se llama cuando el jugador gana el juego.
        function completeGame() { 
            showFinalStats('🌟 ¡Misión Cumplida!'); 
        }

        // C O M E N T A R I O: Se llama cuando el jugador pierde todas sus vidas.
        function gameOver() { 
            showFinalStats('💀 Misión Fallida'); 
        }

        // I N D I C A C I Ó N: Función de utilidad para cerrar todas las ventanas modales.
        function showHelpModal() {
            elements.helpModal.style.display = 'flex';
        }

        function closeModal() {
            document.querySelectorAll('.modal').forEach(m => m.style.display = 'none');
            // C O M E N T A R I O: Si el juego estaba en pausa por un evento que no era una pregunta, lo reanuda.
            if(gameState.isPaused && !gameState.currentQuestion) {
                 resumeGame();
            }
        }

// I N D I C A C I Ó N: Física y animación de los objetos del juego.
        
        // C O M E N T A R I O: Actualiza la posición de la nave para que siga suavemente al puntero.
        function updateSpaceship() { 
            const ship = gameState.spaceship; 
            const dx = ship.targetX - ship.x; 
            const dy = ship.targetY - ship.y; 
            // I N D I C A C I Ó N: La multiplicación por 0.1 crea un efecto de movimiento suave (easing/lerp).
            ship.x += dx * 0.1; 
            ship.y += dy * 0.1; 
            ship.angle = Math.atan2(dy, dx); 
            
            // C O M E N T A R I O: Gestiona la estela de la nave.
            ship.trail.push({ x: ship.x, y: ship.y }); 
            if (ship.trail.length > CONFIG.SPACESHIP.trailLength) ship.trail.shift(); 
        }

        function updateCosmicObjects() { 
            if (gameState.isPaused) return;
            Object.values(gameState.cosmicObjects).flat().forEach((obj, index, arr) => {
                if (obj.type !== 'planet') { // Los planetas no se mueven horizontalmente.
                    obj.x -= obj.speed;
                    obj.angle += obj.rotationSpeed;
                    if (!obj.hasCollided && checkCollision(gameState.spaceship, obj)) {
                        obj.hasCollided = true;
                        handleCollision(obj);
                    }
                    // C O M E N T A R I O: Si un objeto sale de la pantalla, se crea uno nuevo para reemplazarlo.
                    if (obj.x < -100) {
                        arr[index] = createCosmicObject(obj.type);
                    }
                } else {
                    obj.pulsePhase += 0.02; // Actualiza la animación de pulso de los planetas.
                }
            });
        }
        
        function checkCollision(ship, obj) { 
            const dx = ship.x - obj.x; 
            const dy = ship.y - obj.y; 
            return Math.sqrt(dx * dx + dy * dy) < (CONFIG.SPACESHIP.size + obj.size) / 2; 
        }

        function handleCollision(obj) { 
            if (audioSystem) audioSystem.play('collision'); // Sonido de colisión.
            createParticleExplosion(obj.x, obj.y, 25); 
            if (obj.type === 'meteorite' && !gameState.isPaused) { 
                gameState.isPaused = true; 
                setTimeout(() => { showPhysicsInfo(); }, 100); // Muestra un dato curioso en lugar de una pregunta.
            } 
        }
        
        // I N D I C A C I Ó N: Muestra un dato curioso de física al chocar con un meteorito.
        function showPhysicsInfo() {
            const data = [
                { title: '🧑‍🚀 Ecuación de Einstein', content: 'La famosa ecuación $$E=mc^2$$, relaciona la masa y la energía.' },
                { title: '⌛ Dilatación del Tiempo', content: 'El tiempo pasa más lento para un observador en movimiento rápido.' },
                { title: '🚀 Segunda Ley de Newton', content: 'Establece que $$ \\vec{F}_{neta} = m \\cdot \\vec{a} $$.' },
                { title: '🌌 Curiosidad Universal', content: 'El sonido no viaja en el vacío del espacio. ¡Las explosiones de las películas son científicamente incorrectas!' },
                { title: '⚫ Densidad Extrema', content: 'Una cucharadita de material de una estrella de neutrones pesaría miles de millones de toneladas.' },
                { title: '🔗 Entrelazamiento Cuántico', content: 'Dos partículas pueden estar "entrelazadas" de tal forma que el estado de una afecta instantáneamente a la otra, sin importar la distancia.'},
            ];
            const random = data[Math.floor(Math.random() * data.length)];
            elements.feedbackTitle.textContent = random.title;
            elements.feedbackText.innerHTML = '';
            elements.solutionContainer.style.display = 'block';
            elements.solutionContainer.innerHTML = random.content;
            elements.feedbackModal.style.display = 'flex';
            elements.nextButton.textContent = "🚀 Entendido";
            elements.nextButton.onclick = () => {
                gameState.isPaused = false;
                closeModal();
            };
            renderMath(elements.feedbackModal);
        }

        function createParticleExplosion(x, y, count) { for (let i = 0; i < count; i++) gameState.particles.push({ x, y, vx: (Math.random() - 0.5) * 8, vy: (Math.random() - 0.5) * 8, life: 1, decay: 0.02 + Math.random() * 0.02, color: `hsl(${Math.random() * 60}, 100%, 70%)` }); }
        function updateParticles() { if (gameState.isPaused) return; for (let i = gameState.particles.length - 1; i >= 0; i--) { const p = gameState.particles[i]; p.x += p.vx; p.y += p.vy; p.life -= p.decay; p.vy += 0.1; if (p.life <= 0) gameState.particles.splice(i, 1); } }
        function updateStars() { if (gameState.isPaused) return; gameState.stars.forEach(star => { star.x -= star.speed; if (star.x < -5) star.x = elements.canvas.width + 5; }); }
        
        // I N D I C A C I Ó N: Funciones de dibujo en el canvas. Se llaman en cada frame del gameLoop.
        function drawBackground() { const grad = elements.ctx.createLinearGradient(0, 0, 0, elements.canvas.height); grad.addColorStop(0, '#0a0a1f'); grad.addColorStop(1, '#000008'); elements.ctx.fillStyle = grad; elements.ctx.fillRect(0, 0, elements.canvas.width, elements.canvas.height); }
        function drawStars() { gameState.stars.forEach(star => { elements.ctx.globalAlpha = star.alpha; elements.ctx.fillStyle = star.color; elements.ctx.beginPath(); elements.ctx.arc(star.x, star.y, star.radius, 0, Math.PI * 2); elements.ctx.fill(); }); elements.ctx.globalAlpha = 1; }
        function drawSpaceship() { const ship = gameState.spaceship; const ctx = elements.ctx; if(ship.trail.length > 1) { ctx.beginPath(); ctx.moveTo(ship.trail[0].x, ship.trail[0].y); for (let i = 1; i < ship.trail.length; i++) { const point = ship.trail[i]; ctx.globalAlpha = (i / ship.trail.length) * 0.5; ctx.lineTo(point.x, point.y); } ctx.strokeStyle = 'rgba(0, 250, 255, 0.5)'; ctx.lineWidth = 3; ctx.stroke(); ctx.globalAlpha = 1; } ctx.save(); ctx.translate(ship.x, ship.y); ctx.rotate(ship.angle); ctx.shadowColor = '#00faff'; ctx.shadowBlur = 15; ctx.font = `${CONFIG.SPACESHIP.size}px Arial`; ctx.textAlign = 'center'; ctx.textBaseline = 'middle'; ctx.fillText('🚀', 0, 0); ctx.restore(); }
        function drawCosmicObjects() { const ctx = elements.ctx; Object.values(gameState.cosmicObjects).flat().forEach(obj => { ctx.save(); ctx.translate(obj.x, obj.y); ctx.rotate(obj.angle); let size = obj.size; if (obj.type === 'planet') { const pulse = 1 + Math.sin(obj.pulsePhase) * 0.05; size *= pulse; ctx.shadowColor = '#4466ff'; ctx.shadowBlur = 15 + Math.sin(obj.pulsePhase) * 5; } else { ctx.shadowColor = '#ffaa00'; ctx.shadowBlur = 10; } ctx.font = `${size}px Arial`; ctx.textAlign = 'center'; ctx.textBaseline = 'middle'; ctx.fillText(obj.emoji, 0, 0); ctx.restore(); }); }
        function drawParticles() { gameState.particles.forEach(p => { elements.ctx.globalAlpha = p.life; elements.ctx.fillStyle = p.color; elements.ctx.beginPath(); elements.ctx.arc(p.x, p.y, 3, 0, Math.PI * 2); elements.ctx.fill(); }); elements.ctx.globalAlpha = 1; }
        
        // I N D I C A C I Ó N: El bucle principal del juego. Se ejecuta en cada frame.
        function gameLoop() { 
            if (!gameState.isPaused) { 
                elements.ctx.clearRect(0, 0, elements.canvas.width, elements.canvas.height); 
                drawBackground(); 
                updateStars(); 
                drawStars(); 
                updateCosmicObjects(); 
                drawCosmicObjects(); 
                updateSpaceship(); 
                drawSpaceship(); 
                updateParticles(); 
                drawParticles(); 
            } 
            gameState.animationId = requestAnimationFrame(gameLoop); 
        }
        
        // I N D I C A C I Ó N: Función de utilidad para renderizar LaTeX en un elemento del DOM.
        function renderMath(container) {
            if (window.MathJax && window.MathJax.typesetPromise) {
                MathJax.typesetPromise(container ? [container] : undefined).catch(err => console.error('Error al renderizar con MathJax:', err));
            }
        }
        
        // I N D I C A C I Ó N: Funciones para actualizar la interfaz de usuario.
        function updateUI() { elements.level.textContent = gameState.currentLevel; elements.score.textContent = gameState.score; const req = CONFIG.LEVELS[gameState.currentLevel].questions; elements.progress.textContent = `${gameState.currentLevelProgress}/${req}`; const progPerc = req > 0 ? (gameState.currentLevelProgress / req) * 100 : 0; elements.progressFill.style.width = `${progPerc}%`; elements.grade.textContent = calculateGrade().toFixed(1); updateLivesDisplay(); updateTopicDisplay(); }
        function updateLivesDisplay() { elements.lives.innerHTML = ''; for (let i = 0; i < CONFIG.INITIAL_LIVES; i++) { const h = document.createElement('span'); h.className = `heart ${i >= gameState.lives ? 'lost' : ''}`; h.textContent = '❤️'; elements.lives.appendChild(h); } }
        function updateTopicDisplay() { const names = gameState.selectedTopics.map(getTopicDisplayName); const display = names.length > 2 ? `${names.slice(0, 2).join(', ')}...` : names.join(' y '); elements.currentTopic.textContent = display; }
        function getTopicDisplayName(topic) { const names = { magnitudes: 'Magnitudes', si: 'SI', cinematica: 'Cinemática', mru: 'MRU', mrua: 'MRUA', mcu: 'MCU', gravedad: 'Vertical', parabolico: 'Parabólico' }; return names[topic] || topic; }
        function calculateGrade() { if (gameState.questionsAnswered === 0) return 0.0; const acc = gameState.correctAnswers / gameState.questionsAnswered; let grade = acc * 5.0; return Math.min(5.0, grade); }
        
        // I N D I C A C I Ó N: Inicia el juego cuando el DOM esté completamente cargado.
        document.addEventListener('DOMContentLoaded', initializeGame);
    </script>


</html>
