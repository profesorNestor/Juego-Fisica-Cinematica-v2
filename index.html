<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <!-- ğŸ“± Meta viewport mejorado - serÃ¡ actualizado dinÃ¡micamente por OrientationManager -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, viewport-fit=cover">
    
    <!-- ğŸ¨ ConfiguraciÃ³n para PWA y mejor experiencia mÃ³vil -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#0a0a1f">
    
    <title>Academia Espacial: FÃ­sica Interactiva v14 ğŸ“</title>
    
    <!-- ğŸ¨ LIBRERÃAS EXTERNAS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Inter:wght@400;600&family=Exo+2:wght@300;400;600;800&display=swap" rel="stylesheet">
    
    <!-- ğŸ“ ARCHIVOS LOCALES -->
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="orientation-styles.css">
    
    <!-- ğŸ¯ Preload de archivos crÃ­ticos -->
    <link rel="preload" href="orientation-manager.js" as="script">
    <link rel="preload" href="questions.js" as="script">
    <link rel="preload" href="game.js" as="script">
</head>

<body>
    <!-- ğŸš€ CONTENEDOR PRINCIPAL DEL JUEGO -->
    <div class="game-wrapper" id="gameWrapper">
        
        <!-- ğŸ“Š BARRA SUPERIOR - ESTADÃSTICAS -->
        <div class="stats-bar">
            <div class="stat"><span>Nivel:</span><span id="level" class="font-bold">1</span></div>
            <div class="stat"><span>Vidas:</span><div class="lives-container" id="livesContainer"></div></div>
            <div class="stat"><span>Puntos:</span><span id="score" class="font-bold">0</span></div>
            <div class="stat">
                <span>Progreso:</span>
                <span id="progress" class="font-bold">0/10</span>
                <div class="progress-bar w-16 md:w-20"><div id="progressFill" class="progress-fill"></div></div>
            </div>
            <div class="stat"><span>Nota:</span><span id="grade" class="font-bold">0.0</span><span class="text-yellow-400">â­</span></div>
            <div class="stat"><span>Tema:</span><span id="currentTopic" class="font-bold">Magnitudes</span></div>
            
            <!-- ğŸ“± Indicador de orientaciÃ³n (solo mÃ³vil) -->
            <div class="stat mobile-only">
                <span id="orientationIndicator" class="text-xs opacity-75">ğŸ“±</span>
            </div>
        </div>

        <!-- ğŸ® CANVAS DEL JUEGO -->
        <canvas id="gameCanvas"></canvas>

        <!-- ğŸ›ï¸ PANEL DE CONTROLES -->
        <div class="controls-container">
            <div class="control-group" style="width: 100%;">
                <label class="font-bold text-sm text-center w-full mb-2">SELECCIONAR TEMAS DE FÃSICA</label>
                <div class="topic-switcher">
                    <input type="checkbox" id="topicMagnitudes" name="gameTopics" value="magnitudes" checked>
                    <label for="topicMagnitudes">Magnitudes</label>
                    
                    <input type="checkbox" id="topicSI" name="gameTopics" value="si">
                    <label for="topicSI">Sistema SI</label>
                    
                    <input type="checkbox" id="topicCinematica" name="gameTopics" value="cinematica">
                    <label for="topicCinematica">CinemÃ¡tica</label>
                    
                    <input type="checkbox" id="topicMRU" name="gameTopics" value="mru">
                    <label for="topicMRU">MRU</label>
                    
                    <input type="checkbox" id="topicMRUA" name="gameTopics" value="mrua">
                    <label for="topicMRUA">MRUA</label>
                    
                    <input type="checkbox" id="topicMCU" name="gameTopics" value="mcu">
                    <label for="topicMCU">MCU</label>
                    
                    <input type="checkbox" id="topicGravedad" name="gameTopics" value="gravedad">
                    <label for="topicGravedad">Mov. Vertical</label>
                    
                    <input type="checkbox" id="topicParabolico" name="gameTopics" value="parabolico">
                    <label for="topicParabolico">Mov. ParabÃ³lico</label>
                </div>
            </div>
            
            <div class="flex flex-wrap gap-3 md:gap-4 items-center justify-center w-full">
                <div class="control-group">
                    <label for="levelSelect" class="font-bold">Nivel:</label>
                    <select id="levelSelect" class="bg-gray-800 text-white border border-cyan-400 rounded px-2 py-1 md:px-3 md:py-2">
                        <option value="1">1 (10)</option>
                        <option value="2">2 (20)</option>
                        <option value="3">3 (30)</option>
                    </select>
                </div>
                
                <button id="startButton" class="game-button btn-success">
                    <span class="btn-icon">ğŸš€</span>
                    <span id="startButtonText" class="btn-text">Lanzar</span>
                </button>
                
                <button id="pauseButton" class="game-button btn-warning" disabled>
                    <span class="btn-icon">â¸ï¸</span>
                    <span class="btn-text">Pausa</span>
                </button>
                
                <button id="soundButton" class="game-button">
                    <span class="btn-icon">ğŸ”Š</span>
                    <span class="btn-text">Sonido</span>
                </button>
                
                <!-- ğŸ“± BotÃ³n de pantalla completa (mÃ³viles) -->
                <button id="fullscreenButton" class="game-button mobile-only">
                    <span class="btn-icon">ğŸ“º</span>
                    <span class="btn-text">Pantalla</span>
                </button>
                
                <button id="helpButton" class="game-button">
                    <span class="btn-icon">â“</span>
                    <span class="btn-text">Ayuda</span>
                </button>
                
                <button id="resetButton" class="game-button">
                    <span class="btn-icon">ğŸ”„</span>
                    <span class="btn-text">Reiniciar</span>
                </button>
                
                <!-- ğŸ“ El botÃ³n de orientaciÃ³n se agregarÃ¡ dinÃ¡micamente -->
            </div>
            
            <!-- ğŸ“± InformaciÃ³n de orientaciÃ³n para debug (solo desarrollo) -->
            <div id="orientationDebug" class="debug-orientation" style="display: none;"></div>
        </div>
        
        <!-- ğŸ‘¨â€ğŸš€ PIE DE PÃGINA -->
        <footer class="galactic-footer">
            <div id="footer-author" class="footer-author">
                <span class="desktop-only">Autor: Msc NÃ©stor Fabio Montoya Palacios</span>
                <span class="mobile-only">ğŸ“ Academia Espacial v14</span>
            </div>
            <div id="footer-ship">ğŸ›¸</div>
        </footer>
    </div>
    
    <!-- ğŸªŸ MODALES DEL JUEGO -->
    
    <!-- Modal de Preguntas -->
    <div id="questionModal" class="modal">
        <div class="modal-content">
            <h2 class="!text-xl md:!text-2xl">ğŸ¯ DesafÃ­o de FÃ­sica</h2>
            <div id="questionData" class="mb-4 p-3 bg-gray-800 rounded text-xs md:text-sm"></div>
            <div id="questionText" class="text-base md:text-lg mb-6 leading-relaxed"></div>
            <div id="optionsContainer" class="space-y-3"></div>
            <button id="answerButton" class="game-button btn-success mt-6" disabled>âœ… Confirmar</button>
        </div>
    </div>
    
    <!-- Modal de Feedback -->
    <div id="feedbackModal" class="modal">
        <div class="modal-content">
            <h2 id="feedbackTitle"></h2>
            <p id="feedbackText" class="text-lg mb-4"></p>
            <div id="solution-container" style="display: none;"></div>
            <button id="nextButton" class="game-button btn-success mt-6">â–¶ï¸ Continuar</button>
        </div>
    </div>
    
    <!-- Modal de Ayuda -->
    <div id="helpModal" class="modal">
        <div class="modal-content">
            <h2>ğŸ“š Manual del Cadete</h2>
            <div class="text-left space-y-4 text-sm">
                <h3 class="text-cyan-400 font-bold text-lg mb-2">ğŸ¯ MisiÃ³n</h3>
                <p>Pilota tu nave ğŸš€ y colisiona con meteoritos â˜„ï¸. Â¡Responde preguntas de fÃ­sica para dominar el universo!</p>
                
                <h3 class="text-cyan-400 font-bold text-lg mb-2">ğŸ® Controles</h3>
                <ul class="list-disc list-inside space-y-1 ml-4">
                    <li><strong>Mouse/Dedo:</strong> Mueve la nave</li>
                    <li><strong>Colisiones:</strong> Toca meteoritos para aprender</li>
                    <li><strong>Temas:</strong> Elige uno o varios temas</li>
                    <li><strong>Sonido:</strong> Activa/desactiva con ğŸ”Š</li>
                    <li class="mobile-only"><strong>ğŸ“± OrientaciÃ³n:</strong> Gira el dispositivo para mejor experiencia</li>
                    <li class="mobile-only"><strong>ğŸ“º Pantalla completa:</strong> Para juego inmersivo</li>
                </ul>
                
                <h3 class="text-cyan-400 font-bold text-lg mb-2 mobile-only">ğŸ“± Consejos MÃ³vil</h3>
                <ul class="list-disc list-inside space-y-1 ml-4 mobile-only">
                    <li>Usa orientaciÃ³n horizontal para mejor visibilidad</li>
                    <li>Activa pantalla completa para mÃ¡xima inmersiÃ³n</li>
                    <li>El juego se adapta automÃ¡ticamente a tu pantalla</li>
                </ul>
            </div>
            <button id="closeHelp" class="game-button mt-6">ğŸš€ Â¡Entendido!</button>
        </div>
    </div>
    
    <!-- Modal de Subida de Nivel -->
    <div id="levelUpModal" class="modal">
        <div class="modal-content">
            <h2 id="levelUpTitle" class="text-2xl"></h2>
            <p id="levelUpText" class="text-lg mb-6"></p>
            <div id="levelUpStats" class="mb-6 p-4 bg-gray-800 rounded"></div>
            <button id="nextLevelButton" class="game-button btn-success">ğŸš€ Â¡Siguiente Nivel!</button>
        </div>
    </div>
    
    <!-- Modal de Pausa -->
    <div id="pauseModal" class="modal">
        <div class="modal-content">
            <h2>â¸ï¸ Juego Pausado</h2>
            <p class="text-lg mb-6">El tiempo se ha detenido.</p>
            <div class="space-y-4">
                <button id="resumeButton" class="game-button btn-success">â–¶ï¸ Reanudar</button>
                <button id="restartFromPause" class="game-button">ğŸ”„ Reiniciar</button>
                <!-- ğŸ“± Opciones adicionales para mÃ³viles -->
                <div class="mobile-only space-y-2">
                    <button id="fullscreenFromPause" class="game-button">ğŸ“º Pantalla Completa</button>
                    <button id="orientationFromPause" class="game-button">ğŸ“± Rotar Pantalla</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal de EstadÃ­sticas Finales -->
    <div id="finalStatsModal" class="modal">
        <div class="modal-content">
            <h2 id="finalStatsTitle"></h2>
            <div id="finalStatsContent" class="text-left space-y-3 mt-4"></div>
            <button id="restartGameButton" class="game-button btn-success mt-6">ğŸš€ Jugar de Nuevo</button>
        </div>
    </div>

    <!-- ğŸ“ Modal de OrientaciÃ³n (Nuevo) -->
    <div id="orientationModal" class="modal">
        <div class="modal-content">
            <h2>ğŸ“± ConfiguraciÃ³n de OrientaciÃ³n</h2>
            <div class="text-left space-y-4 text-sm">
                <p>Tu dispositivo: <span id="deviceTypeInfo" class="font-bold text-cyan-400"></span></p>
                <p>OrientaciÃ³n actual: <span id="currentOrientationInfo" class="font-bold text-cyan-400"></span></p>
                
                <div class="bg-gray-800 p-4 rounded">
                    <h4 class="text-cyan-400 font-bold mb-2">ğŸ’¡ RecomendaciÃ³n:</h4>
                    <p id="orientationRecommendation">Para la mejor experiencia, te recomendamos usar orientaciÃ³n horizontal.</p>
                </div>
                
                <div class="space-y-2">
                    <button id="lockLandscape" class="game-button w-full">ğŸ“±â¡ï¸ Bloquear Horizontal</button>
                    <button id="lockPortrait" class="game-button w-full">ğŸ“±â¬†ï¸ Bloquear Vertical</button>
                    <button id="unlockOrientation" class="game-button w-full">ğŸ”“ Desbloquear</button>
                </div>
            </div>
            <button id="closeOrientationModal" class="game-button mt-6">âœ… Entendido</button>
        </div>
    </div>

    <!-- ğŸ“œ SCRIPTS EN ORDEN CORRECTO -->
    <script>
        // ğŸ¯ ConfiguraciÃ³n de MathJax INLINE mejorada
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']],
                processEscapes: true,
                processEnvironments: true
            },
            options: {
                skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre']
            },
            startup: {
                ready: () => {
                    console.log('âœ… MathJax configurado correctamente');
                    MathJax.startup.defaultReady();
                    if (window.mathRenderSystem) {
                        window.mathRenderSystem.initialize();
                    }
                }
            }
        };
        
        // ğŸ“± ConfiguraciÃ³n adicional para mÃ³viles
        document.addEventListener('DOMContentLoaded', function() {
            // ğŸ¯ Prevenir zoom accidental en iOS
            document.addEventListener('gesturestart', function(e) {
                e.preventDefault();
            });
            
            // ğŸ“± Mejorar el scroll en mÃ³viles
            document.addEventListener('touchstart', function() {}, {passive: true});
            document.addEventListener('touchmove', function() {}, {passive: true});
            
            // ğŸ”§ Configurar indicador de orientaciÃ³n
            function updateOrientationIndicator() {
                const indicator = document.getElementById('orientationIndicator');
                if (indicator && window.orientationManager) {
                    const orientation = window.orientationManager.currentOrientation;
                    indicator.textContent = orientation === 'landscape' ? 'ğŸ“±â¡ï¸' : 'ğŸ“±â¬†ï¸';
                    indicator.title = `OrientaciÃ³n: ${orientation}`;
                }
            }
            
            // ğŸ® Configurar botÃ³n de pantalla completa
            const fullscreenButton = document.getElementById('fullscreenButton');
            if (fullscreenButton) {
                fullscreenButton.addEventListener('click', function() {
                    if (window.orientationManager) {
                        if (document.fullscreenElement) {
                            window.orientationManager.exitFullscreen();
                        } else {
                            window.orientationManager.requestFullscreen();
                        }
                    }
                });
            }
            
            // ğŸ”„ Actualizar indicador cuando cambie la orientaciÃ³n
            if (window.orientationManager) {
                window.orientationManager.registerOrientationCallback(updateOrientationIndicator);
            }
            
            // ğŸ§ª Mostrar debug en desarrollo
            if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
                const debugElement = document.getElementById('orientationDebug');
                if (debugElement) {
                    debugElement.style.display = 'block';
                    
                    function updateDebugInfo() {
                        if (window.orientationManager) {
                            const info = window.orientationManager.getScreenInfo();
                            debugElement.innerHTML = `
                                ${info.deviceType} | ${info.orientation}<br>
                                ${info.dimensions.width}x${info.dimensions.height}<br>
                                Ratio: ${info.dimensions.ratio}
                            `;
                        }
                    }
                    
                    setInterval(updateDebugInfo, 1000);
                }
            }
        });
    </script>
    
    <!-- ğŸ“ Sistema de orientaciÃ³n (PRIMERO) -->
    <script src="orientation-manager.js"></script>
    
    <!-- ğŸ“š Base de datos del juego -->
    <script src="questions.js"></script>
    <script src="curiosities.js"></script>
    
    <!-- ğŸ® Motor principal (con integraciÃ³n de orientaciÃ³n) -->
    <script src="game.js"></script>
    
    <!-- ğŸ“ Script de integraciÃ³n final -->
    <script>
        // ğŸ¯ IntegraciÃ³n final cuando todo estÃ© cargado
        window.addEventListener('load', function() {
            // â±ï¸ PequeÃ±o delay para asegurar que todo estÃ© inicializado
            setTimeout(function() {
                // ğŸ”— Conectar OrientationManager con el juego
                if (window.orientationManager && window.setupOrientationIntegration) {
                    window.setupOrientationIntegration();
                }
                
                // ğŸ“± ConfiguraciÃ³n inicial
                if (window.orientationManager) {
                    console.log('ğŸ“ Sistema de orientaciÃ³n totalmente integrado');
                    
                    // ğŸ¯ Aplicar configuraciÃ³n inicial
                    if (window.updateConfigForOrientation) {
                        window.updateConfigForOrientation();
                    }
                }
            }, 500);
        });
    </script>
</body>
</html>